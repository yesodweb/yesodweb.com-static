<!doctype html><!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]--><!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]--><!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en"> <!--<![endif]--><head><meta charset="UTF-8"><title>Persistent 0.6.0</title><meta name="description" content="Yesod is a Haskell web framework for productive development of type-safe, RESTful, high performance web applications."><meta name="viewport" content="width=device-width,initial-scale=1"><link href="/feed" type="application/atom+xml" rel="alternate" title="Yesod Web Framework Blog">
<style>article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}audio,canvas,video{display:inline-block;*display:inline;*zoom:1}audio:not([controls]){display:none}[hidden]{display:none}html{font-size:100%;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}body{margin:0}body,button,input,select,textarea{font-family:sans-serif}a{color:#00e}a:visited{color:#551a8b}a:focus{outline:thin dotted}a:hover,a:active{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}blockquote{margin:1em 40px}dfn{font-style:italic}mark{background:#ff0;color:#000}pre,code,kbd,samp{font-family:"DejaVu Sans Mono", "Droid Sans Mono", consolas, "courier new", monospace;_font-family:'courier new', monospace;font-size:.85em}pre{white-space:pre;white-space:pre-wrap;word-wrap:break-word}q{quotes:none}q:before,q:after{content:'';content:none}small{font-size:75%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}ul,ol{margin:1em 0;padding:0 0 0 40px}dd{margin:0 0 0 40px}nav ul,nav ol{list-style:none;list-style-image:none}img{border:0;-ms-interpolation-mode:bicubic}svg:not(:root){overflow:hidden}figure{margin:0}form{margin:0}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em}legend{border:0;*margin-left:-7px}button,input,select,textarea{font-size:100%;margin:0;vertical-align:baseline;*vertical-align:middle}button,input{line-height:normal;*overflow:visible}table button,table input{*overflow:auto}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}pre code{display:block;padding:0.5em;background:#F4F4F4}pre code,pre .ruby .subst,pre .tag .title,pre .lisp .title{color:black}pre .string,pre .title,pre .constant,pre .parent,pre .tag .value,pre .rules .value,pre .rules .value .number,pre .preprocessor,pre .ruby .symbol,pre .ruby .symbol .string,pre .ruby .symbol .keyword,pre .ruby .symbol .keymethods,pre .instancevar,pre .aggregate,pre .template_tag,pre .django .variable,pre .smalltalk .class,pre .addition,pre .flow,pre .stream,pre .bash .variable,pre .apache .tag,pre .apache .cbracket,pre .tex .command,pre .tex .special,pre .erlang_repl .function_or_atom{color:#800}pre .comment,pre .annotation,pre .template_comment,pre .diff .header,pre .chunk{color:#888}pre .number,pre .date,pre .regexp,pre .literal,pre .smalltalk .symbol,pre .smalltalk .char,pre .go .constant,pre .change{color:#080}pre .label,pre .javadoc,pre .ruby .string,pre .decorator,pre .filter .argument,pre .localvars,pre .array,pre .attr_selector,pre .important,pre .pseudo,pre .pi,pre .doctype,pre .deletion,pre .envvar,pre .shebang,pre .apache .sqbracket,pre .nginx .built_in,pre .tex .formula,pre .erlang_repl .reserved,pre .input_number{color:#88F
}pre .css .tag,pre .javadoctag,pre .phpdoc,pre .yardoctag{font-weight:bold}pre .keyword,pre .id,pre .phpdoc,pre .title,pre .built_in,pre .aggregate,pre .smalltalk .class,pre .winutils,pre .bash .variable,pre .apache .tag,pre .go .typename,pre .tex .command{font-weight:bold}pre .nginx .built_in{font-weight:normal}pre .xml .css,pre .xml .javascript,pre .xml .vbscript,pre .tex .formula{opacity:0.5}#archive li > span{cursor:pointer}#comments{margin-top:2em;border-top:1px dashed #000;padding-top:1em;font-weight:300;font-size:1.8em;color:#474f6b;font-family:Lato}code{background-color:#f4f4f4}.github-link{font-size:0.6em}.github-link a,.github-link a:visited{text-decoration:none}#main figure{border:1px solid #CCC;box-shadow:0 0 3px #CCC inset;padding:1em;margin:2ex 0}#main figure figcaption{text-size:.9em;text-align:center;color:#555}#main figure img{border:solid 1px #CCC}#container{min-width:1094px}dd,p{text-align:justify}body{font-family:'Crimson Text', serif;font-size:1.2em;background-color:#e5eef9}a,a:visited{color:#000}a:hover,a:active{color:#823}nav{box-shadow:0 -5px 20px 20px rgba(41,55,78,0.12);z-index:100;background-color:#29374e;padding:5px;font-family:'Lato';font-size:0.80em;font-weight:400;position:fixed;width:100%;top:0}nav ul{margin:0;padding:0;text-align:right}nav ul li{display:inline;margin-right:3em}nav ul li.googleplus{position:relative;top:2px;margin-right:3em}nav ul li.feedlink{position:relative;top:3px}nav a,nav a:visited{color:#eee;text-decoration:none}#spotlight{background-image:-webkit-radial-gradient(50% 50%, circle farthest-side, #fff, #e5eef9 100%);background-image:-moz-radial-gradient(50% 50%, circle farthest-side, #fff, #e5eef9 100%);background-image:-o-radial-gradient(50% 50%, circle farthest-side, #fff, #e5eef9 100%);background-image:-ms-radial-gradient(50% 50%, circle farthest-side, #fff, #e5eef9 100%);background-image:radial-gradient(50% 50%, circle farthest-side, #fff, #e5eef9 100%);position:absolute;width:1050px;height:300px;top:0;left:50%;margin-left:-475px;z-index:-1}div.headergroup{width:1050px;margin:0 auto;padding-top:2.6em;padding-bottom:1.3em}div.headergroup a{text-decoration:none;display:flex}div.headergroup div.homepage-logo{text-align:center;width:550px;height:105px;margin-left:75px}div.headergroup div.homepage-logo div.logo-image{background:url(/static/logo-home2-no-esod-smaller2.png?etag=uBLSXtRu) no-repeat center center;width:100%;height:75px}div.headergroup div.homepage-logo div.logo-text{color:#29374e;padding-top:0.2em;font-family:'Lato';font-weight:300;font-size:1.2em;padding-bottom:0.3em}div.headergroup div.homepage-info{text-align:left;font-family:'Lato';font-weight:300;font-size:0.8em;line-height:1.6em;width:220px}div.headergroup h2{margin-bottom:0;font-size:1.4em;margin-top:0;padding-top:0.4em;padding-bottom:1em}h1,h2,h3,h4,h5,h6,dt{color:#474f6b;font-family:'Lato';font-weight:400}h1{font-weight:300;font-size:1.8em}h2,section > section > h1{font-weight:400;font-size:1.5em;margin-bottom:0.5em}h3,section > section > section > h1{font-weight:400;font-size:1.2em;margin-bottom:0.5em}h1 span{display:none}section{display:table-cell}section h2{margin-top:2.2em;margin-bottom:0}section img{max-width:100%}section section{display:block;width:auto;padding:0;margin:0}section.why{width:600px;padding-left:90px;padding-right:90px}section.why article{width:600px}section.getting-started{background-color:#f4f4f4;width:300px;padding-left:50px;padding-right:50px}section.getting-started h2{font-size:1.2em;margin-bottom:0.7em;margin-top:1.8em}section.getting-started ul{font-family:'Lato';font-size:0.75em;font-weight:500;margin-bottom:20px;line-height:2em;list-style-type:none;margin-bottom:50px;padding-left:0}section.getting-started ul ul{font-size:.9em }section.getting-started div{font-family:'Lato';padding-left:20px}#main{box-shadow:0 10px 25px 25px rgba(41,55,78,0.05);background-color:#fff;position:relative;width:1050px;margin:0 auto}aside#announcement{box-shadow:0 0 20px 10px rgba(41,55,78,0.12);height:20px;margin:0 auto;position:relative;width:1080px;background-color:#29374e;color:#eee;padding:0.5em;font-family:'Lato';font-weight:400;font-size:0.8em;z-index:50}aside#announcement div.msg{margin-left:105px}aside#announcement div.tri-left,aside#announcement div.tri-right{width:0;height:0;position:absolute;bottom:-21px;border-style:solid}aside#announcement div.tri-left{left:0;border-width:11px 11px 10px 11px;border-color:#0b1b30 #0b1b30 transparent transparent}aside#announcement div.tri-right{right:0;border-width:11px 11px 11px 10px;border-color:#0b1b30 transparent transparent #0b1b30}aside#announcement a,aside#announcement a:visited{color:#eee;text-decoration:underline}aside#announcement span.date{font-style:italic;font-size:0.8em}#feedlink{display:inline-block;height:16px;width:16px;background:url(/static/blog.png?etag=oPHrQ5qo)}#feedlink span{display:none}dt{font-weight:400;font-size:1.05em;margin-bottom:0.7em;margin-top:2.3em}dd,p{margin:0;font-size:1em;line-height:155%;margin-bottom:0.5em}p.what{display:none;font-size:1.4em;padding:0 200px}#instantclick{display:none}@media print, (max-width: 700px) {body{background-color:#fff;padding:3px}.googleplus,.feedlink,.headergroup,#announcement,#comments,#disqus_thread,#spotlight,#license,.github-link,.oreilly,.main-listing{display:none}div .headergroup{display:none}#container > nav{background-color:#fff;box-shadow:none}#container > nav > ul{text-align:left}#container > nav > ul a,#container > nav > ul a:visited{color:#00f}#main,div#container,section.why > article{width:auto;min-width:0}#main{box-shadow:none;position:static;margin:0}section.why,section.getting-started{display:block;width:auto;padding:0;background-color:#fff}hgroup h1[itemprop=name],hgroup h2,hgroup h3{margin:0}hgroup h1[itemprop=name] img,hgroup h2 img,hgroup h3 img{display:none}dd,p,dt{margin:12px}}@media print {nav{display:none}section.getting-started{display:none}}</style><!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><link href="//fonts.googleapis.com/css?family=Crimson+Text:400,400italic,600,600italic,700,700italic" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic" rel="stylesheet" type="text/css"><script>document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/,'js');</script></head><body itemscope itemtype="http://schema.org/Product"><div id="spotlight"></div><div id="container"><nav><ul><li><a href="/book">book</a></li><li><a href="/wiki">cookbook</a></li><li><a href="/blog">blog</a></li><li><a href="/wiki/Home">wiki</a></li><li class="feedlink"><a href="/feed" id="feedlink"><span>newsfeed</span></a></li></ul></nav><div class="headergroup"><a href="/"><div class="homepage-logo"><div class="logo-image"></div><div class="logo-text">Yesod Web Framework</div></div><div class="homepage-info">Yesod is a Haskell web framework for productive development of type-safe, RESTful, high performance web applications.</div></a></div><aside id="announcement"><div class="tri-left"></div><div class="tri-right"></div><div class="msg"><span class="subject">Persistent 0.6.0</span></div></aside><div id="main" role="main"><section class="why"><h1>Persistent 0.6.0</h1><h2>August 26, 2011</h2><h3><img width="80" height="80" itemprop="image" src="https://www.gravatar.com/avatar/71596bb1ca3ba3aa4400c3f407baec9f?size=80" alt="Gravatar">By Michael Snoyman</h3><p class="github-link"><a href="https://github.com/yesodweb/yesodweb.com-content/tree/master/blog/2011/8/persistent-0-6-0.html">View source on Github</a></p><article><h1>Persistent</h1><p class="hascomments" id="file825-persistent-i1">Forms deal with the boundary between the user and the application. Another boundary we need to deal with is between the application and the storage layer. Whether it be a SQL database, a YAML file, or a binary blob, odds are you have to work to get your storage layer to accept your application datatypes. Persistent is Yesod&#39;s answer to data storage- a type-safe universal data store interface for Haskell. 
      </p><p class="hascomments" id="file825-persistent-i1.5">Haskell has many different database bindings available. However, most of these have little knowledge of a schema and therefore do not provide useful static guarantees and force database-dependent interfaces and data structures on the programmer. Haskellers have attempted a more revolutionary route of creating Haskell specific data stores to get around these flaws that allow one to easily store any Haskell type. These options are great for certain use cases, but they constrain one to the storage techniques provided by the library, do not interface well with other languages, and the flexibility can also mean one must write reams of code for querying data. In contrast, Persistent allows us to choose among existing databases that are highly tuned for different data storage use cases, interoperate with other programming languages, and to use a safe and productive query interface.
      </p><p class="hascomments" id="file825-persistent-i2">Persistent follows the guiding principles of type safety and concise, declarative syntax. Some other nice features are:</p><ul id="file825-persistent-x1"><li id="file825-persistent-x2">Database-agnostic. There is first class support for PostgreSQL, SQLite and MongoDB.</li><li id="file825-persistent-x3">By being non-relational in nature, we simultaneously are able to support a wider number of storage layers and are not constrained by some of the performance bottlenecks incurred through joins.</li><li id="file825-persistent-x4">A major source of frustration in dealing with SQL databases is changes to the schema. Persistent can automatically perform database migrations.</li></ul>
    

<section .subtopic=""><h1>Synopsis</h1>  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TemplateHaskell, TypeFamilies, OverloadedStrings #-}</span>
<span style="color: gray;">{-# LANGUAGE GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Control.Monad.IO.Class</span> (liftIO)

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span> <span style="color: blue;">Maybe</span>
<span style="color: blue;">BlogPost</span>
    title <span style="color: blue;">String</span>
    authorId <span style="color: blue;">PersonId</span>
|]

<span style="color: blue;font-weight: bold;">main</span> :: <span style="color: blue;">IO</span> ()
<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll

    johnId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;John Doe&quot;</span> $ <span style="color: blue;">Just</span> <span style="color: teal;">35</span>
    janeId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Jane Doe&quot;</span> <span style="color: blue;">Nothing</span>

    insert $ <span style="color: blue;">BlogPost</span> <span style="color: green;">&quot;My fr1st p0st&quot;</span> johnId
    insert $ <span style="color: blue;">BlogPost</span> <span style="color: green;">&quot;One more for good measure&quot;</span> johnId

    oneJohnPost &lt;- selectList [<span style="color: blue;">BlogPostAuthorId</span> ==. johnId] [<span style="color: blue;">LimitTo</span> <span style="color: teal;">1</span>]
    liftIO $ print (oneJohnPost :: [(<span style="color: blue;">BlogPostId</span>, <span style="color: blue;">BlogPost</span>)])

    john &lt;- get johnId
    liftIO $ print (john :: <span style="color: blue;">Maybe</span> <span style="color: blue;">Person</span>)

    delete janeId
    deleteWhere [<span style="color: blue;">BlogPostAuthorId</span> ==. johnId]
</pre></pre>
 </section><section .subtopic=""><h1>Solving the boundary issue</h1><p class="hascomments" id="file807-solving-the-boundary-issue-b1">Let&#39;s say you are storing information on people in a SQL database. Your table might look something like:</p><pre class="codeblock" id="file807-solving-the-boundary-issue-x1">CREATE TABLE Person(id SERIAL PRIMARY KEY, name VARCHAR NOT NULL, age INTEGER)</pre><p class="hascomments" id="file807-solving-the-boundary-issue-b2">And if you are using a database like PostgreSQL, you can be guaranteed that the database will never store some arbitrary text in your age field. (The same cannot be said of SQLite, but let&#39;s forget about that for now.) To mirror this database table, you would likely create a Haskell datatype that looks something like:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Person</span> = <span style="color: blue;">Person</span>
    { personName :: <span style="color: blue;">String</span>
    , personAge :: <span style="color: blue;">Int</span>
    }
</pre></pre><p class="hascomments" id="file807-solving-the-boundary-issue-b3">It looks like everything is type safe: the database schema matches our Haskell datatypes, the database ensures that invalid data can never make it into our data store, and everything is generally awesome. Well, until:</p><ul id="file807-solving-the-boundary-issue-x3"><li id="file807-solving-the-boundary-issue-x4">You want to pull data from the database, and the database layer gives you the data in an untyped format.</li><li id="file807-solving-the-boundary-issue-x5">You want to find everyone older than 32, and you accidently write &quot;thirtytwo&quot; in your SQL statement. Guess what: that will compile just fine, and you won&#39;t find out you have a problem until runtime.</li><li id="file807-solving-the-boundary-issue-x6">You decide you want to do something as simple as find the first 10 people alphabetically. No problem... until you make a typo in your SQL. Once again, you don&#39;t find out until runtime.</li></ul><p class="hascomments" id="file807-solving-the-boundary-issue-b4">In dynamic languages, the answers to these issues is unit testing. For everything that <i id="file807-solving-the-boundary-issue-x7">can</i> go wrong, make sure you write a test case. But as I am sure you are aware by now, that doesn&#39;t jive well with the Yesod approach to things. We like to take advantage of Haskell&#39;s strong typing to save us wherever possible, and data storage is no exception.</p><p class="hascomments" id="file807-solving-the-boundary-issue-b5">So the question remains: how can we use Haskell&#39;s type system to save the day?</p><section .subtopic=""><h1>Types</h1><p class="hascomments" id="file804-types-ba1">Like routing, there is nothing intrinsically difficult about type-safe data access. It
            just requires a lot of monotonous, error prone, boiler plate code. As usual, this means
            we can use the type system to keep us honest. And to avoid some of the drudgery, we&#39;ll
            use a sprinkling of Template Haskell.</p>
<aside class="note" id="file804-types-x1">Earlier versions of Persistent made much heavier usage of Template Haskell. Starting
            with 0.6, there is a new architecture inspired by the <a href="http://hackage.haskell.org/package/groundhog">groundhog</a>
            package. This approach uses phantom types to carry a lot of the burden.</aside>
<p class="hascomments" id="file804-types-ba2"><code id="file804-types-x3">PersistValue</code> is the basic building block of Persistent. It is a very simple datatype that can represent data that gets sent to and from a database. Its definition is:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">PersistValue</span> = <span style="color: blue;">PersistText</span> <span style="color: blue;">Text</span>
                  | <span style="color: blue;">PersistByteString</span> <span style="color: blue;">ByteString</span>
                  | <span style="color: blue;">PersistInt64</span> <span style="color: blue;">Int64</span>
                  | <span style="color: blue;">PersistDouble</span> <span style="color: blue;">Double</span>
                  | <span style="color: blue;">PersistBool</span> <span style="color: blue;">Bool</span>
                  | <span style="color: blue;">PersistDay</span> <span style="color: blue;">Day</span>
                  | <span style="color: blue;">PersistTimeOfDay</span> <span style="color: blue;">TimeOfDay</span>
                  | <span style="color: blue;">PersistUTCTime</span> <span style="color: blue;">UTCTime</span>
                  | <span style="color: blue;">PersistNull</span>
                  | <span style="color: blue;">PersistList</span> [<span style="color: blue;">PersistValue</span>]
                  | <span style="color: blue;">PersistMap</span> [(<span style="color: blue;">T.Text</span>, <span style="color: blue;">PersistValue</span>)]
                  | <span style="color: blue;">PersistForeignKey</span> <span style="color: blue;">ByteString</span> <span style="color: gray;">-- ^ intended especially for MongoDB backend</span>
</pre></pre><p class="hascomments" id="file804-types-ba4">Each Persistent backend needs to know how to translate the relevant values into something the database can understand. However, it would be awkward do have to express all of our data simply in terms of these basic types. The next layer is the <code id="file804-types-x5">PersistField</code> typeclass, which defines how an arbitrary Haskell datatype can be marshaled to and from a <code id="file804-types-x6">PersistValue</code>. A PersistField correlates to a column in a SQL database. In our person example above, name and age would be our <code id="file804-types-x7">PersistField</code>s.</p><p class="hascomments" id="file804-types-ba5">To tie up the user side of the code, our last typeclass is <code id="file804-types-x8">PersistEntity</code>. An instance of PersistEntity correlates with a table in a
            SQL database. This typeclass defines a number of functions and some associated types. To
            review, we have the following correspondence between Persistent and SQL:</p>
        <table id="file804-types-simpletable_hmz_kck_kd"><thead id="file804-types-x9"><td id="file804-types-x10">SQL</td>
                <td id="file804-types-x11">Persistent</td>
            </thead>
            <tr id="file804-types-x12"><td id="file804-types-x13">Datatypes (VARCHAR, INTEGER, etc)</td>
                <td id="file804-types-x14">PersistValue</td>
            </tr>
            <tr id="file804-types-x15"><td id="file804-types-x16">Table</td>
                <td id="file804-types-x17">PersistEntity</td>
            </tr>
            <tr id="file804-types-x18"><td id="file804-types-x19">Column</td>
                <td id="file804-types-x20">PersistField</td>
            </tr>
        </table></section><section .subtopic=""><h1>Code Generation</h1><p class="hascomments" id="file805-code-generation-bb1">In order to ensure that the PersistEntity instances match up properly with your Haskell datatypes, Persistent takes responsibility for both. This is also good from a DRY (Don&#39;t Repeat Yourslef) perspective: you only need to define your entities once. Let&#39;s see a quick example:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>

<span style="color: blue;font-weight: bold;">mkPersist</span> sqlSettings [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span>
|]
</pre></pre><p class="hascomments" id="file805-code-generation-bb2">We use a combination of Template Haskell and Quasi-Quotation (like when defining
            routes): <code id="file805-code-generation-x6">persistent-template:Database.Persist.TH:persist</code> is a
            quasi-quoter which converts a whitespace-sensitive syntax into a list of entity
            definitions. (You can also declare your entities in a separate file using
                <code id="file805-code-generation-x9">persistent-template:Database.Persist.TH:persistFile</code>.)
                <code id="file805-code-generation-x10">persistent-template:Database.Persist.TH:mkPersist</code> takes that list
            of entities and declares:</p><ul id="file805-code-generation-x2"><li id="file805-code-generation-x3">One Haskell datatype for each entity.</li><li id="file805-code-generation-x4">A PersistEntity instance for each datatype defined.</li></ul><p class="hascomments" id="file805-code-generation-bb3">Of course, the interesting part is how to use this datatype once it is defined.</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    michaelId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: teal;">26</span>
    michael &lt;- get michaelId
    liftIO $ print michael
</pre></pre><p class="hascomments" id="file805-code-generation-bb4">We start off with some standard database connection code. In this case, we used the single-connection functions. Persistent also comes built in with connection pool functions, which we will generally want to use in production.</p><p class="hascomments" id="file805-code-generation-bb5">In this example, we have seen two functions: insert creates a new record in the database and returns its ID. Like everything else in Persistent, IDs are type safe. We&#39;ll get into more details of how these IDs work later. So when you call <code id="file805-code-generation-x7">insert $ Person &quot;Michael&quot; 25</code>, it gives you a value back of type <code id="file805-code-generation-x8">PersonId</code>.</p>
<p class="hascomments" id="file805-code-generation-bb6">The next function we see is get, which attempts to load a value from the database using an <code id="file805-code-generation-x11">Id</code>. In Persistent, you never need to worry that you are using the key from the wrong table: trying to load up a different entity (like House) using a <code id="file805-code-generation-x12">PersonId</code> will never compile.</p></section><section .subtopic=""><h1>PersistBackend</h1><p class="hascomments" id="file806-persistbackend-bc1">One last detail is left unexplained from the previous example: what are those withSqliteConn and runSqlConn functions doing, and what is that monad that our database actions are running in?</p><p class="hascomments" id="file806-persistbackend-bc2">All database actions need to occur within an instance of
            <code id="file806-persistbackend-x1">PersistBackend</code>. As its name implies, every backend (PostgreSQL, SQLite,
            MongoDB) has an instance of PersistBackend. This is where all the translations from
                <code id="file806-persistbackend-x2">PersistValue</code> to database-specific values occur, where SQL query
            generation happens, and so on.</p><aside class="note" id="file806-persistbackend-x3"><p class="hascomments" id="file806-persistbackend-bc3">As you can imagine, even though PersistBackend provides a safe, well-typed interface to the outside world, there are a lot of database interactions that could go wrong. However, by testing this code automatically and thoroughly in a central location, we can centralize our error-prone code into a single location and make sure it is as bug-free as possible.</p></aside><p class="hascomments" id="file806-persistbackend-bc4">withSqliteConn creates a single connection to a database using its supplied connection string. For our test cases, we will use &quot;:memory:&quot;, which simply uses an in-memory database. runSqlConn uses that connection to run the inner action, in this case, SqlPersist. Both SQLite and PostgreSQL share the same instance of PersistBackend.</p><p class="hascomments" id="file806-persistbackend-bc5">One important thing to note is that everything which occurs inside a single call to runSqlConn runs in a single transaction. This has two important implications:</p><ul id="file806-persistbackend-x4"><li id="file806-persistbackend-x5">For many databases, committing a transaction can be a costly activity. By putting multiple steps into a single transaction, you can speed up code dramatically.</li><li id="file806-persistbackend-x6">If an exception is thrown anywhere inside a single call to runSqlConn, all actions will be rolled back.</li></ul></section></section><section .subtopic=""><h1>Migrations</h1><p class="hascomments" id="file808-migrations-m1">I&#39;m sorry to tell you, but so far I have lied to you a bit: the example from the previous section does not actually work. If you try to run it, you will get an error message about a missing table.</p><p class="hascomments" id="file808-migrations-m2">For SQL databases, one of the major pains can be managing schema changes. Instead of leaving this to the user, Persistent steps in to help, but you have to <i id="file808-migrations-x1">ask</i> it to help. Let&#39;s see what this looks like:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Control.Monad.IO.Class</span> (liftIO)

<span style="color: blue;font-weight: bold;">mkPersist</span> sqlSettings [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span>
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration $ migrate (undefined :: <span style="color: blue;">Person</span>) <span style="color: gray;">-- this line added: that&#39;s it!</span>
    michaelId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: teal;">26</span>
    michael &lt;- get michaelId
    liftIO $ print michael
</pre></pre><p class="hascomments" id="file808-migrations-m3">With this one little code change, Persistent will automatically create your Person table for you. This split between runMigration and migrate allows you to migrate multiple tables simultaneously.</p><p class="hascomments" id="file808-migrations-m4">This works when dealing with just a few entities, but can quickly get tiresome once we are dealing with a dozen entities. Instead of repeating yourself, Persistent provides a helper function:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span>
<span style="color: blue;">Car</span>
    color <span style="color: blue;">String</span>
    make <span style="color: blue;">String</span>
    model <span style="color: blue;">String</span>
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll
</pre></pre><p class="hascomments" id="file808-migrations-m5">mkMigrate is a Template Haskell function which creates a new function that will automatically call migrate on all entities defined in the persist block. The share function is just a little helper that passes the information from the persist block to each Template Haskell function and concatenates the results.</p><p class="hascomments" id="file808-migrations-m6">Persistent has very conservative rules about what it will do during a migration. It starts by loading up table information from the database, complete with all defined SQL datatypes. It then compares that against the entity definition given in the code. For simple cases, it will automatically alter the schema:</p><ul id="file808-migrations-x4"><li id="file808-migrations-x5">The datatype of a field changed. However, the database may object to this modification if the data cannot be translated.</li><li id="file808-migrations-x6">A field was added. However, if the field is not null, no default value is supplied (we&#39;ll discuss defaults later) and there is already data in the database, the database will not allow this to happen.</li><li id="file808-migrations-x7">A field is converted from not null to null. In the opposite case, Persistent will attempt the conversion, contingent upon the database&#39;s approval.</li><li id="file808-migrations-x8">A brand new entity is added.</li></ul><p class="hascomments" id="file808-migrations-m7">However, there are a number of cases that Persistent will not handle:</p><ul id="file808-migrations-x9"><li id="file808-migrations-x10">Field or entity renames: Persistent has no way of knowing that &quot;name&quot; has now been renamed to &quot;fullName&quot;: all it sees is an old field called name and a new field called fullName.</li><li id="file808-migrations-x11">Field removals: since this can result in data loss, Persistent by default will refuse to perform the action (you can force the issue by using runMigrationUnsafe instead of runMigration, though it is <b id="file808-migrations-x12">not</b> recommended).</li></ul><p class="hascomments" id="file808-migrations-m8">runMigration will print out the migrations it is running on stderr (you can bypass this by using runMigrationSilent). Whenever possible, it uses ALTER TABLE calls. However, in SQLite, ALTER TABLE has very limited abilities, and therefore Persistent must resort to copying the data from one table to another.</p><p class="hascomments" id="file808-migrations-m9">Finally, if instead of <i id="file808-migrations-x13">performing</i> a migration, you just want Persistent to give you hints about what migrations are necessary, use the printMigration function. This function will print out the migrations which runMigration would perform for you. This may be useful for performing migrations that Persistent is not capable of, for adding arbitrary SQL to a migration, or just to log what migrations occurred.</p><aside class="note" id="file808-migrations-x14"><p class="hascomments" id="file808-migrations-m10">Although there is no official Persistent integration, there is a haskell package that can assist with running migrations called <a href="http://hackage.haskell.org/package/dbmigrations">dbmigrations</a>.</p></aside></section><section .subtopic=""><h1>Uniqueness</h1><p class="hascomments" id="file809-uniqueness-u1">In addition to declaring fields within an entity, you can also declare uniqueness
            constraints. A typical example would be requiring that a username be unique.</p>
        <figure id="file809-uniqueness-x1"><figcaption>Unique Username</figcaption>
            
            <pre class="codeblock" id="file809-uniqueness-x5">User
    username Text
    UniqueUsername username</pre>
        </figure>
        <p class="hascomments" id="file809-uniqueness-x6">While each field name must begin with a lowercase letter, the uniqueness constraints must
            begin with an uppercase letter.</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Data.Time</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Control.Monad.IO.Class</span> (liftIO)

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    firstName <span style="color: blue;">String</span>
    lastName <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span>
    <span style="color: blue;">PersonName</span> firstName lastName
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span> <span style="color: teal;">26</span>
    michael &lt;- getBy $ <span style="color: blue;">PersonName</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span>
    liftIO $ print michael
</pre></pre><p class="hascomments" id="file809-uniqueness-u2">To declare a unique combination of fields, we add an extra line to our declaration. Persistent knows that it is defining a unique constructor, since the line begins with a capital letter. Each following word must be a field in this entity.</p><p class="hascomments" id="file809-uniqueness-u3">The main restriction on uniqueness is that it can only be applied non-null fields. The reason for this is that the SQL standard is ambiguous on how uniqueness should be applied to NULL (eg, is NULL=NULL true or false?). Besides that ambiguity, most SQL engines in fact implement rules which would be <i id="file809-uniqueness-x3">contrary</i> to what the Haskell datatypes anticipate (eg, PostgreSQL says that NULL=NULL is false, whereas Haskell says Nothing == Nothing is True).</p>
        <p class="hascomments" id="file809-uniqueness-x7">In addition to providing nice guarantees at the database level about consistency of your
            data, uniqueness constraints can also be used to perfect some specific queries within
            your Haskell code, like the getBy demonstrated above. This happens via the Unique
            associated type. In the example above, we end up with a new constructor:</p>
        <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: blue;">PersonName</span> :: <span style="color: blue;">String</span> -&gt; <span style="color: blue;">String</span> -&gt; <span style="color: blue;">Unique</span> <span style="color: blue;">Person</span>
</pre></pre></section><section .subtopic=""><h1>Queries</h1><section .subtopic=""><h1>Fetching by ID</h1>
  <p class="hascomments" id="file810-fetching-by-id-x1">The simplest query you can perform in Persistent is getting based on an ID. Since this value
   may or may not exist, its return type is wrapped in a Maybe.</p>
  <figure id="file810-fetching-by-id-x2"><figcaption>Using get</figcaption>
   
   <pre class="codeblock"><pre style="padding: 0;margin: 0;">personId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span> <span style="color: teal;">26</span>
    maybePerson &lt;- get personId
    <span style="color: green;font-weight: bold;">case</span> maybePerson <span style="color: green;font-weight: bold;">of</span>
        <span style="color: blue;">Nothing</span> -&gt; liftIO $ putStrLn <span style="color: green;">&quot;Just kidding, not really there&quot;</span>
        <span style="color: blue;">Just</span> person -&gt; liftIO $ print person
</pre></pre>
  </figure>
  <p class="hascomments" id="file810-fetching-by-id-x5">This can be very useful for sites that provide URLs like <code class="filepath" id="file810-fetching-by-id-x6">/person/5</code>.
   However, in such a case, we don&#39;t usually care about the Maybe wrapper, and just want the value,
   returning a 404 message if it is not found. Fortunately, the
    <a href="http://hackage.haskell.org/packages/archive/yesod-persist/latest/doc/html/Yesod-Persist.html#v:get404">get404</a> function helps us out here. We&#39;ll go into
   more details when we see integration with Yesod.</p>
 </section><section .subtopic=""><h1>Fetching by unique constraint</h1>
  <p class="hascomments" id="file811-fetching-by-unique-constraint-x1">getBy is almost identical to get, except it takes a uniqueness constraint instead of an ID it
   takes a Unique value.</p>
  <figure id="file811-fetching-by-unique-constraint-x2"><figcaption>Using getBy</figcaption>
   
   <pre class="codeblock"><pre style="padding: 0;margin: 0;">personId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span> <span style="color: teal;">26</span>
    maybePerson &lt;- getBy $ <span style="color: blue;">UniqueName</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span>
    <span style="color: green;font-weight: bold;">case</span> maybePerson <span style="color: green;font-weight: bold;">of</span>
        <span style="color: blue;">Nothing</span> -&gt; liftIO $ putStrLn <span style="color: green;">&quot;Just kidding, not really there&quot;</span>
        <span style="color: blue;">Just</span> person -&gt; liftIO $ print person
</pre></pre>
  </figure>
 </section><section .subtopic=""><h1>Select functions</h1>
  <p class="hascomments" id="file813-select-functions-x1">But likely, you&#39;re going to want more powerful queries. You&#39;ll want to find everyone over a
   certain age; all cars available in blue; all users without a registered email address. For this,
   you need one of the select functions.</p>
  <p class="hascomments" id="file813-select-functions-x2">All the select functions use a similar interface, with slightly different outputs:</p>
  <table id="file813-select-functions-simpletable_wxh_wgw_kd"><thead id="file813-select-functions-x3"><td id="file813-select-functions-x4">Function</td>
    <td id="file813-select-functions-x5">Returns</td>
   </thead>
   <tr id="file813-select-functions-x6"><td id="file813-select-functions-x7">selectEnum</td>
    <td id="file813-select-functions-x8">An Enumerator containing all the IDs and values from the database.</td>
   </tr>
   <tr id="file813-select-functions-x9"><td id="file813-select-functions-x10">selectList</td>
    <td id="file813-select-functions-x11">A list containing all the IDs and values from the database.</td>
   </tr>
   <tr id="file813-select-functions-x12"><td id="file813-select-functions-x13">selectFirst</td>
    <td id="file813-select-functions-x14">Takes just the first ID and value from the database, if available</td>
   </tr>
   <tr id="file813-select-functions-x15"><td id="file813-select-functions-x16">selectKeys</td>
    <td id="file813-select-functions-x17">Returns only the keys, without the values, as an Enumerator</td>
   </tr>
  </table>
  <p class="hascomments" id="file813-select-functions-x18">selectList is the most commonly used, so we will cover it specifically. But understanding the
   others should be trivial after that.</p>
  <p class="hascomments" id="file813-select-functions-x19">selectList takes two arguments: a list of Filters, and a list of SelectOpts. The former is what
   limits your results based on characteristics; it allows for equals, less than, is member of, and
   such. SelectOpts provides for three different features: sorting, limiting output to a certain
   number of rows, and offsetting results by a certain number of rows.</p>
  <aside class="note" id="file813-select-functions-x20">The combination of limits and offsets is very important, it allows for efficient pagination
   in your webapps.</aside>
  <p class="hascomments" id="file813-select-functions-x21">Let&#39;s jump straight into an example of filtering, and then analyze it.</p>
   <pre class="codeblock"><pre style="padding: 0;margin: 0;">people &lt;- selectList [<span style="color: blue;">PersonAge</span> &gt;. <span style="color: teal;">25</span>, <span style="color: blue;">PersonAge</span> &lt;=. <span style="color: teal;">30</span>] []
    liftIO $ print people
</pre></pre>
  <p class="hascomments" id="file813-select-functions-x23">As simple as that example is, we really need to cover three points:</p>
  <ol id="file813-select-functions-ol_zxf_yhw_kd"><li id="file813-select-functions-x24">PersonAge is a constructor for an associated phantom type. That might sound scary, but what&#39;s
    important is that it uniquely identifies the &quot;age&quot; column of the &quot;person&quot; table, and that it
    knows that the age field is an Int. (That&#39;s the phantom part.)</li>
   <li id="file813-select-functions-x25">We have a bunch of Persistent filtering operators. They&#39;re all pretty straight-forward: just
    tack a period to the end of what you&#39;d expect. There are three gotchas here, I&#39;ll explain
    below.</li>
   <li id="file813-select-functions-x26">The list of filters is ANDed together, so that our constraint means &quot;age is greater than 25
    AND age is less than or equal to 30&quot;. We&#39;ll describe ORing later.</li>
  </ol>
  <p class="hascomments" id="file813-select-functions-x27">The one operator that&#39;s surprisingly named is the not equals one. We use !=., since /=. is used
   for updates (described later). Don&#39;t worry: if you use the wrong one, the compiler will catch
   you. The other two surprising operators are the &quot;is member&quot; and &quot;is not member&quot;. They are,
   respectively, <code id="file813-select-functions-x28">&lt;-.</code> and <code id="file813-select-functions-x29">/&lt;-.</code> (both end with a period).</p>
  <p class="hascomments" id="file813-select-functions-x30">And regarding ORs, we use the <code id="file813-select-functions-x31">||.</code> operator. Let&#39;s see an example:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;">people &lt;- selectList
        (       [<span style="color: blue;">PersonAge</span> &gt;. <span style="color: teal;">25</span>, <span style="color: blue;">PersonAge</span> &lt;=. <span style="color: teal;">30</span>]
            ||. [<span style="color: blue;">PersonFirstName</span> /&lt;-. [<span style="color: green;">&quot;Adam&quot;</span>, <span style="color: green;">&quot;Bonny&quot;</span>]]
            ||. ([<span style="color: blue;">PersonAge</span> ==. <span style="color: teal;">50</span>] ||. [<span style="color: blue;">PersonAge</span> ==. <span style="color: teal;">60</span>])
        )
        []
    liftIO $ print people
</pre></pre>
  <p class="hascomments" id="file813-select-functions-x33">This (completely nonsensical) example means: find people who are 26-30, inclusive, OR whose
   names are neither Adam or Bonny, OR whose age is either 50 or 60.</p>
 <section .subtopic=""><h1>SelectOpt</h1>
  <p class="hascomments" id="file812-selectopt-x1">All of our selectList calls have included an empty list as the second parameter. That specifies
   no options, meaning: sort however the database wants, return all results, and don&#39;t skip any
   results. A SelectOpt has four constructors that can be used to change all that.</p>
  <dl id="file812-selectopt-x2"><dt id="file812-selectopt-x4">Asc</dt>
    <dd id="file812-selectopt-x5">Sort by the given column in ascending order. This uses the same phantom type as filtering,
     such as PersonAge.</dd>
   
   
    <dt id="file812-selectopt-x7">Desc</dt>
    <dd id="file812-selectopt-x8">Same as Asc, in descending order.</dd>
   
   
    <dt id="file812-selectopt-x10">LimitTo</dt>
    <dd id="file812-selectopt-x11">Takes an Int argument. Only return up to the specified number of results.</dd>
   
   
    <dt id="file812-selectopt-x13">OffsetBy</dt>
    <dd id="file812-selectopt-x14">Takes an Int argument. Skip the specified number of results.</dd>
   
  </dl>
  <p class="hascomments" id="file812-selectopt-x15">The following code defines a function that will break down results into pages. It returns all
   people aged 18 and over, and then sorts them by age (oldest person first). For people with the
   same age, they are sorted alphabetically by last name, then first name.</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: blue;font-weight: bold;">resultsForPage</span> pageNumber = <span style="color: green;font-weight: bold;">do</span>
    <span style="color: green;font-weight: bold;">let</span> resultsPerPage = <span style="color: teal;">10</span>
    selectList
        [ <span style="color: blue;">PersonAge</span> &gt;=. <span style="color: teal;">18</span>
        ]
        [ <span style="color: blue;">Desc</span> <span style="color: blue;">PersonAge</span>
        , <span style="color: blue;">Asc</span> <span style="color: blue;">PersonLastName</span>
        , <span style="color: blue;">Asc</span> <span style="color: blue;">PersonFirstName</span>
        , <span style="color: blue;">LimitTo</span> resultsPerPage
        , <span style="color: blue;">OffsetBy</span> $ (pageNumber - <span style="color: teal;">1</span>) * resultsPerPage
        ]
</pre></pre>
 </section></section></section><section .subtopic=""><h1>Manipulation</h1><section .subtopic=""><h1>Insert</h1>  <p class="hascomments" id="file815-insert-x1">It&#39;s all well and good to be able to play with data in the database, but how does it get there
   in the first place? The answer is the insert function. Its usage is incredibly simple, as you&#39;ve
   seen already. You just give it a value, and it gives back an ID.</p>
  <p class="hascomments" id="file815-insert-x2">At this point, it makes sense to explain a it of the philosophy behind Persistent. In many
   other ORM solutions, the datatypes used to hold data is opaque: you need to go through their
   defined interfaces to get at and modify the data. That&#39;s not the case with Persistent: we&#39;re
   using plain old Algebraic Data Types for the whole thing. This means you still get all the great
   benefits of pattern matching, currying and everything else you&#39;re used to.</p>
  <p class="hascomments" id="file815-insert-x3">However, there are a few things we <i id="file815-insert-x4">can&#39;t</i> do. For one, there&#39;s no way to automatically
   update values in the database every time the record is updated in Haskell. Of course, with
   Haskell&#39;s normal stance of purity and immutability, this wouldn&#39;t make much sense anyway, so I
   don&#39;t shed any tears over it.</p>
  <p class="hascomments" id="file815-insert-x5">However, there is one issue that newcomers are often bothered by: why are IDs and values
   completely separate? It seems like it would be very logical to embed the ID inside the value. In
   other words, instead of
   having:<pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Person</span> = <span style="color: blue;">Person</span> { name :: <span style="color: blue;">String</span> }
</pre></pre>have<pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Person</span> = <span style="color: blue;">Person</span> { personId :: <span style="color: blue;">PersonId</span>, name :: <span style="color: blue;">String</span> }
</pre></pre></p>
  <p class="hascomments" id="file815-insert-x8">Well, there&#39;s one problem with this right off the bat: how do we do an insert? If a Person
   needs to have an ID, and we get the ID by inserting, and an insert needs a Person, we have an
   impossible loop. Now, we could solve this with undefined, but that&#39;s just asking for trouble.</p>
  <p class="hascomments" id="file815-insert-x9">OK, you say, let&#39;s try something a bit
   safer:<pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Person</span> = <span style="color: blue;">Person</span> { personId :: <span style="color: blue;">Maybe</span> <span style="color: blue;">PersonId</span>, name :: <span style="color: blue;">String</span> }
</pre></pre>I
   definitely prefer <code id="file815-insert-x11">insert $ Person Nothing &quot;Michael&quot;</code> to <code id="file815-insert-x12">insert $ Person
    undefined &quot;Michael&quot;</code>. And now our types will be much simpler, right? For example,
   selectList could return a simple <code id="file815-insert-x13">[Person]</code> instead of that ugly
    <code id="file815-insert-x14">[(PersonId, Person)]</code>.</p>
  <p class="hascomments" id="file815-insert-x15">The problem is that the &quot;ugliness&quot; is incredibly useful. Having <code id="file815-insert-x16">(PersonId,
    Person)</code> makes it obvious, at the type level, that we&#39;re dealing with a value that
   exists in the database. Let&#39;s say we want to create a link to another page that requires the
    <code id="file815-insert-x17">PersonId</code> (not an uncommon occurrence as we&#39;ll discuss later). The (PersonId,
   Person) form gives us unambiguous access to that information; embedding PersonId within Person
   with a Maybe wrapper means an extra runtime check for Just, instead of a more error-proof compile
   time check.</p>
  <p class="hascomments" id="file815-insert-x18">Finally, there&#39;s a semantic mismatch with embedding the ID within the value. The Person is the
   value. Two people are identical (in the context of a database) if all their fields are the same.
   By embedding the ID in the value, we&#39;re no longer talking about a person, but about a row in the
   database. Equality is no longer really equality, it&#39;s identity: is this the <i id="file815-insert-x19">same person</i>.
   as opposed to equivalent person.</p>
  <p class="hascomments" id="file815-insert-x20">In other words, there are some annoyances with having the ID separated out, but overall, it&#39;s
   the <i id="file815-insert-x21">right</i> approach, which in the grand scheme of things leads to better, less buggy
   code.</p>
 </section><section .subtopic=""><h1>Update</h1>  <p class="hascomments" id="file816-update-x1">Now, in the context of that discussion, let&#39;s think about updating. The simplest way to update
   is:<pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">let</span> michael = <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: teal;">26</span>
    michaelAfterBirthday = michael { personAge = <span style="color: teal;">27</span> }
</pre></pre>But
   that&#39;s not actually updating anything, it&#39;s just creating a new person value based on the old
   one. When we say update, we&#39;re <i id="file816-update-x3">not</i> talking about modifications to the values in Haskell.
   (We better not be of course, since Haskell data types are immutable.)</p>
  <p class="hascomments" id="file816-update-x4">Instead, we&#39;re looking at ways of modifying rows in a table. And the simplest way to do that is
   with the update function.</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;">personId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span> <span style="color: teal;">26</span>
    update personId [<span style="color: blue;">PersonAge</span> =. <span style="color: teal;">27</span>]
</pre></pre>
  <p class="hascomments" id="file816-update-x6">update simply takes two arguments: an ID, and a list of Updates. The simplest update is
   assignment, but it&#39;s not always the best. What if you want to increase someones age by 1, but you
   don&#39;t have their current age? Persistent has you covered:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: blue;font-weight: bold;">haveBirthday</span> personId = update personId [<span style="color: blue;">PersonAge</span> +=. <span style="color: teal;">1</span>]
</pre></pre>
  <p class="hascomments" id="file816-update-x8">And as you might expect, we have all the basic mathematical operators: +=., -=., *=., and /=.
   (full stop). These can be convenient for updating a single record, but they are also essential
   for proper ACID guarantees. Imagine the alternative: pull out a Person, increment the age, and
   update the new value. If you have two threads/processes working on this database at the same
   time, you&#39;re in for a world of hurt (hint: race conditions).</p>
  <p class="hascomments" id="file816-update-x9">Sometimes you&#39;ll want to update many fields at once (give all your employees a 5% pay increase,
   for example). updateWhere takes two parameters: a list of filters, and a list of updates to
   apply.</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;">updateWhere [<span style="color: blue;">PersonFirstName</span> ==. <span style="color: green;">&quot;Michael&quot;</span>] [<span style="color: blue;">PersonAge</span> *=. <span style="color: teal;">2</span>] <span style="color: gray;">-- it&#39;s been a long day</span>
</pre></pre>
  <p class="hascomments" id="file816-update-x11">Occasionally, you&#39;ll just want to completely replace the value in a database with a different
   value. For that, you use (surprise) the replace function.</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;">personId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span> <span style="color: teal;">26</span>
    replace personId $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;John&quot;</span> <span style="color: green;">&quot;Doe&quot;</span> <span style="color: teal;">20</span>
</pre></pre>
</section><section .subtopic=""><h1>Delete</h1>
  <p class="hascomments" id="file817-delete-x1">As much as it pains us, sometimes we must part with our data. To do so, we have three
   functions:</p>
  <dl id="file817-delete-x2"><dt id="file817-delete-x4">delete</dt>
    <dd id="file817-delete-x5">Delete based on an ID</dd>
   
   
    <dt id="file817-delete-x7">deleteBy</dt>
    <dd id="file817-delete-x8">Delete based on a unique constraint</dd>
   
   
    <dt id="file817-delete-x10">deleteWhere</dt>
    <dd id="file817-delete-x11">Delete based on a set of filters</dd>
   
  </dl>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;">personId &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span> <span style="color: teal;">26</span>
    delete personId
    deleteBy $ <span style="color: blue;">UniqueName</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span>
    deleteWhere [<span style="color: blue;">PersonFirstName</span> ==. <span style="color: green;">&quot;Michael&quot;</span>]
</pre></pre>
  <p class="hascomments" id="file817-delete-x13">We can even use deleteWhere to wipe out all the records in a table, we just need to give some
   hints to GHC as to what table we&#39;re interested in:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;">deleteWhere ([] :: [<span style="color: blue;">Filter</span> <span style="color: blue;">Person</span>])
</pre></pre>
 </section></section><section .subtopic=""><h1>Attributes</h1><p class="hascomments" id="file819-attributes-attr1">So far, we have seen a very simple syntax for our persist blocks: a line for the name of our entities, and then an indented line for each field with two words: the name of the field and the datatype of the field. Persistent handles more than this: you can assign an arbitrary list of attributes after the first two words on a line.</p><p class="hascomments" id="file819-attributes-attr2">Let&#39;s say that we want to have a Person entity with an (optional) age and the timestamp of when he/she was added to the system. For entities already in the database, we want to just use the current date-time for that timestamp.</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Data.Time</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Control.Monad.IO.Class</span>

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span> <span style="color: blue;">Maybe</span>
    created <span style="color: blue;">UTCTime</span> <span style="color: green;font-weight: bold;">default</span>=now()
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    time &lt;- liftIO getCurrentTime
    runMigration migrateAll
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> (<span style="color: blue;">Just</span> <span style="color: teal;">26</span>) time
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Greg&quot;</span> <span style="color: blue;">Nothing</span> time
</pre></pre><p class="hascomments" id="file819-attributes-attr3"><code id="file819-attributes-x2">Maybe</code> is a built in, single word attribute. It makes the
            field optional. In Haskell, this means it is wrapped in a Maybe. In SQL, it makes the
            column nullable.</p>
        <p class="hascomments" id="file819-attributes-x8">The <code id="file819-attributes-x3">default</code> attribute is backend specific, and uses whatever
            syntax is understood by the database. In this case, it uses the database&#39;s built-in
            now() function. Let&#39;s say we now want to add a field for favorite programming
            language:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Data.Time</span>

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span> <span style="color: blue;">Maybe</span>
    created <span style="color: blue;">UTCTime</span> <span style="color: green;font-weight: bold;">default</span>=now()
    language <span style="color: blue;">String</span> <span style="color: green;font-weight: bold;">default</span>=&#39;<span style="color: blue;">Haskell&#39;</span>
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll
</pre></pre>
<aside class="note" id="file819-attributes-x5">The <code id="file819-attributes-x6">default</code> attribute has absolutely no impact on the Haskell code itself; you still need to fill in all values. This will only affect the database schema and automatic migrations.</aside>
<p class="hascomments" id="file819-attributes-attr4">We need to surround the string with single quotes so that the database can properly interpret it. Finally, Persistent can use double quotes for containing white space, so let&#39;s say we want to set someone&#39;s default home country to the El Salvador:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Data.Time</span>

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span> <span style="color: blue;">Maybe</span>
    created <span style="color: blue;">UTCTime</span> <span style="color: green;font-weight: bold;">default</span>=now()
    language <span style="color: blue;">String</span> <span style="color: green;font-weight: bold;">default</span>=&#39;<span style="color: blue;">Haskell&#39;</span>
    country <span style="color: blue;">String</span> <span style="color: green;">&quot;default=&#39;El Salvador&#39;&quot;</span>
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll
</pre></pre>
        <p class="hascomments" id="file819-attributes-x9">One last trick you can do with attributes is to specify the names to be used for the SQL
            tables and columns. This can be very convenient when interacting with existing
            databases.</p>
        <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span> sql=the-person-table
    firstName <span style="color: blue;">String</span> sql=first_name
    lastName <span style="color: blue;">String</span> sql=fldLastName
    age <span style="color: blue;">Int</span> <span style="color: blue;">Gt</span> <span style="color: blue;">Desc</span> <span style="color: green;">&quot;sql=The Age of the Person&quot;</span>
    <span style="color: blue;">UniqueName</span> firstName lastName
|]
</pre></pre></section><section .subtopic=""><h1>Relations</h1><p class="hascomments" id="file820-relations-r1">Persistent allows references between your data types in a manner that is consistent with
            supporting non-SQL databases. We do this by embedding an ID in the related entity. So if
            a person has many cars:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Control.Monad.IO.Class</span> (liftIO)
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Data.Time</span>

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
<span style="color: blue;">Car</span>
    ownerId <span style="color: blue;">PersonId</span> <span style="color: blue;">Eq</span>
    name <span style="color: blue;">String</span>
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll
    bruce &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Bruce Wayne&quot;</span>
    insert $ <span style="color: blue;">Car</span> bruce <span style="color: green;">&quot;Bat Mobile&quot;</span>
    insert $ <span style="color: blue;">Car</span> bruce <span style="color: green;">&quot;Porsche&quot;</span>
    <span style="color: gray;">-- this could go on a while</span>
    cars &lt;- selectList [<span style="color: blue;">CarOwnerId</span> ==. bruce] []
    liftIO $ print cars
</pre></pre><p class="hascomments" id="file820-relations-r4">Using this technique, it&#39;s very easy to define one-to-many relationships. To define many-to-many relationships, we need a join entity, which has a one-to-many relationship with each of the original tables. It is also a good idea to use uniqueness constraints on these. For example, to model a situation where we want to track which people have shopped in which stores:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Data.Time</span>

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
<span style="color: blue;">Store</span>
    name <span style="color: blue;">String</span>
<span style="color: blue;">PersonStore</span>
    personId <span style="color: blue;">PersonId</span>
    storeId <span style="color: blue;">StoreId</span>
    <span style="color: blue;">UniquePersonStore</span> personId storeId
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll

    bruce &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Bruce Wayne&quot;</span>
    michael &lt;- insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span>

    target &lt;- insert $ <span style="color: blue;">Store</span> <span style="color: green;">&quot;Target&quot;</span>
    gucci &lt;- insert $ <span style="color: blue;">Store</span> <span style="color: green;">&quot;Gucci&quot;</span>
    sevenEleven &lt;- insert $ <span style="color: blue;">Store</span> <span style="color: green;">&quot;7-11&quot;</span>

    insert $ <span style="color: blue;">PersonStore</span> bruce gucci
    insert $ <span style="color: blue;">PersonStore</span> bruce sevenEleven

    insert $ <span style="color: blue;">PersonStore</span> michael target
    insert $ <span style="color: blue;">PersonStore</span> michael sevenEleven
</pre></pre></section><section .subtopic=""><h1>Closer look at types</h1>
  <p class="hascomments" id="file821-closer-look-at-types-x1">So far, we&#39;ve spoken about Person and PersonId without really explaining what they are. In the
   simplest sense, for a SQL-only system, the PersonId could just be <code id="file821-closer-look-at-types-x2">type PersonId =
    Int64</code>. However, that means there is nothing binding a PersonId at the type level to the
   Person entity. Instead, it would be very easy to accidently use a PersonId and get a Car. In
   order to model this relationship, we use phantom types. So, our next naive step would be:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">newtype</span> <span style="color: blue;">Key</span> entity = <span style="color: blue;">Key</span> <span style="color: blue;">Int64</span>
<span style="color: green;font-weight: bold;">type</span> <span style="color: blue;">PersonId</span> = <span style="color: blue;">Key</span> <span style="color: blue;">Person</span>
</pre></pre>
  <aside class="note" id="file821-closer-look-at-types-x4">Prior to Persistent 0.6, we used associated types instead of phantom types. You could solve
   the problem in that direction as well, but phantoms worked out better.</aside>
  <p class="hascomments" id="file821-closer-look-at-types-x5">And that works out really well, until you get to a backend that doesn&#39;t use Int64 for its IDs.
   And that&#39;s not just a theoretical question; MongoDB uses ByteStrings instead. So what we need is
   a key value that can contain an Int and a ByteString. Seems like a great time for a sum type:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Key</span> entity = <span style="color: blue;">KeyInt</span> <span style="color: blue;">Int64</span> | <span style="color: blue;">KeyByteString</span> <span style="color: blue;">ByteString</span>
</pre></pre>
  <p class="hascomments" id="file821-closer-look-at-types-x7">But that&#39;s just asking for trouble. Next we&#39;ll have a backend that uses timestamps, so we&#39;ll
   need to add something to Key. This could go on for a while. Fortunately, we already have a sum
   type intended for representing arbitrary data: PersistValue. So now, we can use:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">newtype</span> <span style="color: blue;">Key</span> entity = <span style="color: blue;">Key</span> <span style="color: blue;">PersistValue</span>
</pre></pre>
  <p class="hascomments" id="file821-closer-look-at-types-x9">But this has another problem. Let&#39;s say we have a web application that takes an ID as a
   parameter from the user. It will need to receive that parameter as Text and then try to convert
   it to a Key. Well, that&#39;s simple: write a function to convert a Text to a PersistValue, and then
   wrap the result in the Key constructor, right?</p>
  <p class="hascomments" id="file821-closer-look-at-types-x10">Wrong. We tried this, and there&#39;s a big problem with it. We end up getting Keys that could
   never be. For example, if we&#39;re dealing with SQL, a key must be an integer. But the approach
   described above would allow arbitrary textual data in. The result was a bunch of 500 server
   errors as the database choked on comparing an integer column to text.</p>
  <p class="hascomments" id="file821-closer-look-at-types-x11">So what we need is a way to convert text to a Key, but have it dependent on the rules of the
   backend in question. And once phrased that way, the answer is simple: just add another phantom.
   The real, actual definition of Key in Persistent is:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">newtype</span> <span style="color: blue;">Key</span> backend entity = <span style="color: blue;">Key</span> { unKey :: <span style="color: blue;">PersistValue</span> }
</pre></pre>
  <p class="hascomments" id="file821-closer-look-at-types-x13">This works great: we can have a <code id="file821-closer-look-at-types-x14">Text -&gt; Key MongoDB entity</code> function and a
    <code id="file821-closer-look-at-types-x15">Text -&gt; Key SqlPersist entity</code> function, and everything runs smoothly. But now
   we have a new problem: relations. Let&#39;s say we want to represent blogs and blog posts. We would
   use the entity definition:</p>
  <pre class="codeblock" id="file821-closer-look-at-types-x16">Blog
    title Text
Post
    title Text
    blogId BlogId</pre>
  <p class="hascomments" id="file821-closer-look-at-types-x17">But what would that look like in terms of our Key datatype?</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Blog</span> = <span style="color: blue;">Blog</span> { blogTitle :: <span style="color: blue;">Text</span> }
<span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Post</span> = <span style="color: blue;">Post</span> { postTitle :: <span style="color: blue;">Text</span>, postBlogId :: <span style="color: blue;">Key</span> &lt;what goes here?&gt; <span style="color: blue;">Blog</span> }
</pre></pre>
  <p class="hascomments" id="file821-closer-look-at-types-x19">We need something to fill in as the backend. In theory, we could hardcode this to SqlPersist,
   or Mongo, but then our datatypes will only work for a single backend. For an individual
   application, that might be acceptable, but what about libraries defining datatypes to be used by
   multiple applications, using multiple backends?</p>
  <p class="hascomments" id="file821-closer-look-at-types-x20">So thinks got a little more complicated. Our types are actually:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">BlogGeneric</span> backend = <span style="color: blue;">Blog</span> { blogTitle :: <span style="color: blue;">Text</span> }
<span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">PostGeneric</span> backend = <span style="color: blue;">Post</span> { postTitle :: <span style="color: blue;">Text</span>, postBlogId :: <span style="color: blue;">Key</span> backend (<span style="color: blue;">BlogGeneric</span> backend) }
</pre></pre>
  <p class="hascomments" id="file821-closer-look-at-types-x22">Notice that we still keep the short names for the constructors and the records. Finally, to
   give a simple interface for normal code, we define some type synonyms:</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: green;font-weight: bold;">type</span> <span style="color: blue;">Blog</span> = <span style="color: blue;">BlogGeneric</span> <span style="color: blue;">SqlPersist</span>
<span style="color: green;font-weight: bold;">type</span> <span style="color: blue;">BlogId</span> = <span style="color: blue;">Key</span> <span style="color: blue;">SqlPersist</span> <span style="color: blue;">Blog</span>
<span style="color: green;font-weight: bold;">type</span> <span style="color: blue;">Post</span> = <span style="color: blue;">PostGeneric</span> <span style="color: blue;">SqlPersist</span>
<span style="color: green;font-weight: bold;">type</span> <span style="color: blue;">PostId</span> = <span style="color: blue;">Key</span> <span style="color: blue;">SqlPersist</span> <span style="color: blue;">Post</span>
</pre></pre>
  <p class="hascomments" id="file821-closer-look-at-types-x24">And no, SqlPersist isn&#39;t hard-coded into Persistent anywhere. That sqlSettings parameter you&#39;ve
   been passing to mkPersist is what tells us to use SqlPersist. Mongo code will use mongoSettings
   instead.</p>
  <p class="hascomments" id="file821-closer-look-at-types-x25">This might be quite complicated under the surface, but user code hardly ever touches this. Look
   back through this whole chapter: not once did we need to deal with the Key or Generic stuff
   directly. The most common place for it to pop up is in compiler error messages. So it&#39;s important
   to be aware that this exists, but it shouldn&#39;t affect you on a day-to-day basis.</p>
 </section><section .subtopic=""><h1>Custom Fields</h1><p class="hascomments" id="file822-custom-fields-cf1">Occasionally, you will want to define a custom field to be used in your datastore. The most common case is an enumeration, such as employment status. For this, Persistent provides a helper Template Haskell function:</p><pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving, TemplateHaskell, OverloadedStrings, GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span>

<span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">Employment</span> = <span style="color: blue;">Employed</span> | <span style="color: blue;">Unemployed</span> | <span style="color: blue;">Retired</span>
    <span style="color: green;font-weight: bold;">deriving</span> (<span style="color: blue;">Show</span>, <span style="color: blue;">Read</span>, <span style="color: blue;">Eq</span>)
<span style="color: blue;font-weight: bold;">derivePersistField</span> <span style="color: green;">&quot;Employment&quot;</span>

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">String</span>
    employment <span style="color: blue;">Employment</span>
|]

<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll

    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Bruce Wayne&quot;</span> <span style="color: blue;">Retired</span>
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Peter Parker&quot;</span> <span style="color: blue;">Unemployed</span>
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: blue;">Employed</span>
</pre></pre><p class="hascomments" id="file822-custom-fields-cf2">derivePersistField stores the data in the database using a string field, and performs marshaling using the Show and Read instances of the datatype. This may not be as efficient as storing via an integer, but it is much more future proof: even if you add extra constructors in the future, your data will still be valid.</p></section><section .subtopic=""><h1>Persistent: Raw SQL</h1>  <p class="hascomments" id="file823-persistent-raw-sql-x1">The Persistent package provides a type safe interface to data stores. It tries to be
            backend-agnostic, such as not relying on relational features of SQL. My experience has
            been you can easily perform 95% of what you need to do with the high-level interface.
            (In fact, most of my web apps use the high level interface exclusively.)</p>
  <p class="hascomments" id="file823-persistent-raw-sql-x2">But occasionally you&#39;ll want to use a feature that&#39;s specific to a backend. One feature I&#39;ve
   used in the past is full text search. In this case, we&#39;ll use the SQL &quot;LIKE&quot; operator, which is
   not modeled in Persistent. We&#39;ll get all people with the last name &quot;Snoyman&quot; and print the
   records out.</p>
        <aside class="note" id="file823-persistent-raw-sql-x4">Actually, you <i id="file823-persistent-raw-sql-x5">can</i> express a LIKE operator directly in the normal syntax due to a
            new feature in Persistent 0.6, which allows backend-specific operators. But this is
            still a good example, so let&#39;s roll with it.</aside>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE OverloadedStrings #-}</span>
<span style="color: gray;">{-# LANGUAGE TemplateHaskell #-}</span>
<span style="color: gray;">{-# LANGUAGE QuasiQuotes #-}</span>
<span style="color: gray;">{-# LANGUAGE TypeFamilies #-}</span>
<span style="color: gray;">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span>
<span style="color: gray;">{-# LANGUAGE GADTs #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span> (withSqliteConn)
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.TH</span> (mkPersist, persist, share, mkMigrate, sqlSettings)
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.GenericSql</span> (runSqlConn, runMigration, <span style="color: blue;">SqlPersist</span>)
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.GenericSql.Raw</span> (withStmt)
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.GenericSql.Internal</span> (<span style="color: blue;">RowPopper</span>)
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Data.Text</span> (<span style="color: blue;">Text</span>)
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Control.Monad.IO.Class</span> (liftIO)

<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    name <span style="color: blue;">Text</span>
|]

<span style="color: blue;font-weight: bold;">main</span> :: <span style="color: blue;">IO</span> ()
<span style="color: blue;font-weight: bold;">main</span> = withSqliteConn <span style="color: green;">&quot;:memory:&quot;</span> $ runSqlConn $ <span style="color: green;font-weight: bold;">do</span>
    runMigration migrateAll
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael Snoyman&quot;</span>
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Miriam Snoyman&quot;</span>
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Eliezer Snoyman&quot;</span>
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Gavriella Snoyman&quot;</span>
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Greg Weber&quot;</span>
    insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Rick Richardson&quot;</span>

    <span style="color: gray;">-- Persistent does not provide the LIKE keyword, but we&#39;d like to get the</span>
    <span style="color: gray;">-- whole Snoyman family...</span>
    <span style="color: green;font-weight: bold;">let</span> sql = <span style="color: green;">&quot;SELECT name FROM Person WHERE name LIKE &#39;%Snoyman&#39;&quot;</span>
    withStmt sql [] withPopper

<span style="color: gray;">-- A popper returns one row at a time. We loop over it until it returns Nothing.</span>
<span style="color: blue;font-weight: bold;">withPopper</span> :: <span style="color: blue;">RowPopper</span> (<span style="color: blue;">SqlPersist</span> <span style="color: blue;">IO</span>) -&gt; <span style="color: blue;">SqlPersist</span> <span style="color: blue;">IO</span> ()
<span style="color: blue;font-weight: bold;">withPopper</span> popper =
    loop
  <span style="color: green;font-weight: bold;">where</span>
    loop = <span style="color: green;font-weight: bold;">do</span>
        mrow &lt;- popper
        <span style="color: green;font-weight: bold;">case</span> mrow <span style="color: green;font-weight: bold;">of</span>
            <span style="color: blue;">Nothing</span> -&gt; return ()
            <span style="color: blue;">Just</span> row -&gt; liftIO (print row) &gt;&gt; loop
</pre></pre>
 </section><section .subtopic=""><h1>Integration with Yesod</h1>
  <p class="hascomments" id="file824-integration-with-yesod-x1">So you&#39;ve been convinced of the power of Persistent. How do you integrate it with your Yesod
   application? Well, if you use the scaffolding, most of the work is done for you already. But as
   we normally do, we&#39;ll build up everything manually here to point out how it works under the
   surface.</p>
  <p class="hascomments" id="file824-integration-with-yesod-x2">The <a href="http://hackage.haskell.org/package/yesod-persistent">yesod-persistent</a> package provides the meeting point between Persistent
   and Yesod. It provides the YesodPersist typeclass, to standardize access to the database via the
   runDB method. Let&#39;s see this in action.</p>
  <pre class="codeblock"><pre style="padding: 0;margin: 0;"><span style="color: gray;">{-# LANGUAGE QuasiQuotes, TypeFamilies, GeneralizedNewtypeDeriving #-}</span>
<span style="color: gray;">{-# LANGUAGE TemplateHaskell, OverloadedStrings, GADTs, MultiParamTypeClasses #-}</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Yesod</span>
<span style="color: green;font-weight: bold;">import</span> <span style="color: blue;">Database.Persist.Sqlite</span>

<span style="color: gray;">-- Define our entities as usual</span>
<span style="color: blue;font-weight: bold;">share</span> [mkPersist sqlSettings, mkMigrate <span style="color: green;">&quot;migrateAll&quot;</span>] [persist|
<span style="color: blue;">Person</span>
    firstName <span style="color: blue;">String</span>
    lastName <span style="color: blue;">String</span>
    age <span style="color: blue;">Int</span> <span style="color: blue;">Gt</span> <span style="color: blue;">Desc</span>
|]

<span style="color: gray;">-- We keep our connection pool in the foundation. At program initialization, we</span>
<span style="color: gray;">-- create our initial pool, and each time we need to perform an action we check</span>
<span style="color: gray;">-- out a single connection from the pool.</span>
<span style="color: green;font-weight: bold;">data</span> <span style="color: blue;">PersistTest</span> = <span style="color: blue;">PersistTest</span> <span style="color: blue;">ConnectionPool</span>

<span style="color: gray;">-- We&#39;ll create a single route, to access a person. It&#39;s a very common</span>
<span style="color: gray;">-- occurrence to use an Id type in routes.</span>
<span style="color: blue;font-weight: bold;">mkYesod</span> <span style="color: green;">&quot;PersistTest&quot;</span> [parseRoutes|
/person/#<span style="color: blue;">PersonId</span> <span style="color: blue;">PersonR</span> <span style="color: blue;">GET</span>
|]

<span style="color: gray;">-- Nothing special here</span>
<span style="color: green;font-weight: bold;">instance</span> <span style="color: blue;">Yesod</span> <span style="color: blue;">PersistTest</span> <span style="color: green;font-weight: bold;">where</span>
    approot _ = <span style="color: green;">&quot;&quot;</span>

<span style="color: gray;">-- Now we need to define a YesodPersist instance, which will keep track of</span>
<span style="color: gray;">-- which backend we&#39;re using and how to run an action.</span>
<span style="color: green;font-weight: bold;">instance</span> <span style="color: blue;">YesodPersist</span> <span style="color: blue;">PersistTest</span> <span style="color: green;font-weight: bold;">where</span>
    <span style="color: green;font-weight: bold;">type</span> <span style="color: blue;">YesodPersistBackend</span> <span style="color: blue;">PersistTest</span> = <span style="color: blue;">SqlPersist</span>

    <span style="color: gray;">-- This is a bit complicated, but liftIOHandler is necessary for proper</span>
    <span style="color: gray;">-- handling of exceptions.</span>
    runDB action = liftIOHandler $ <span style="color: green;font-weight: bold;">do</span>
        <span style="color: blue;">PersistTest</span> pool &lt;- getYesod
        runSqlPool action pool

<span style="color: gray;">-- We&#39;ll just return the show value of a person, or a 404 if the Person doesn&#39;t</span>
<span style="color: gray;">-- exist.</span>
<span style="color: blue;font-weight: bold;">getPersonR</span> :: <span style="color: blue;">PersonId</span> -&gt; <span style="color: blue;">Handler</span> <span style="color: blue;">RepPlain</span>
<span style="color: blue;font-weight: bold;">getPersonR</span> personId = <span style="color: green;font-weight: bold;">do</span>
    person &lt;- runDB $ get404 personId
    return $ <span style="color: blue;">RepPlain</span> $ toContent $ show person

<span style="color: blue;font-weight: bold;">openConnectionCount</span> :: <span style="color: blue;">Int</span>
<span style="color: blue;font-weight: bold;">openConnectionCount</span> = <span style="color: teal;">10</span>

<span style="color: blue;font-weight: bold;">main</span> :: <span style="color: blue;">IO</span> ()
<span style="color: blue;font-weight: bold;">main</span> = withSqlitePool <span style="color: green;">&quot;test.db3&quot;</span> openConnectionCount $ \pool -&gt; <span style="color: green;font-weight: bold;">do</span>
    runSqlPool (runMigration migrateAll) pool
    runSqlPool (insert $ <span style="color: blue;">Person</span> <span style="color: green;">&quot;Michael&quot;</span> <span style="color: green;">&quot;Snoyman&quot;</span> <span style="color: teal;">26</span>) pool
    warpDebug <span style="color: teal;">3000</span> $ <span style="color: blue;">PersistTest</span> pool
</pre></pre>
  <p class="hascomments" id="file824-integration-with-yesod-x5">There are two important pieces here for general use. runDB is used to run a DB action from
   within a Handler. That liftIOHandler is a little scary, but it can be safely ignored. It is
   necessary in order to properly catch exceptions and rollback changes. Within the runDB, you can
   use any of the functions we&#39;ve spoken about so far, such as insert and selectList.</p>
  <p class="hascomments" id="file824-integration-with-yesod-x6">The other new feature is get404. It works just like get, but instead of returning a Nothing
   when a result can&#39;t be found, it returns a 404 message page. The getPersonR function is a very
   common approach used in real-world Yesod applications: get404 a value and then return a response
   based on it.</p>
 </section>
</article><p id="comments">Comments</p><div id="disqus_thread"></div><p><a class="dsq-brlink" href="https://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></p></section><script type="text/javascript">var disqus_shortname = 'yesoddocs';(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><section class="getting-started"><h2>Archives</h2><div id="archive"><ul><li id="nav-2021"><span>2021</span><ul><li id="nav-202102"><span>February</span><ul><li class="leaf"><a href="/blog/2021/02/chatwisely-intro">We Made ChatWisely With Haskell</a></li></ul></li></ul></li><li id="nav-2020"><span>2020</span><ul><li id="nav-202005"><span>May</span><ul><li class="leaf"><a href="/blog/2020/05/blogannouncement">A new Haskell/Yesod Beginners Blog</a></li></ul></li></ul></li><li id="nav-2019"><span>2019</span><ul><li id="nav-201912"><span>December</span><ul><li class="leaf"><a href="/blog/2019/12/bookportuguese">A new Yesod book in Portuguese</a></li></ul></li><li id="nav-201902"><span>February</span><ul><li class="leaf"><a href="/blog/2019/02/deprecating-googleemail2">Deprecating GoogleEmail2</a></li></ul></li></ul></li><li id="nav-2018"><span>2018</span><ul><li id="nav-201801"><span>January</span><ul><li class="leaf"><a href="/blog/2018/01/upcoming-yesod-breaking-changes">Upcoming Yesod breaking changes</a></li></ul></li></ul></li><li id="nav-2017"><span>2017</span><ul><li id="nav-201711"><span>November</span><ul><li class="leaf"><a href="/blog/2017/11/mega-sdist">mega-sdist: the mega repo helper</a></li></ul></li><li id="nav-201706"><span>June</span><ul><li class="leaf"><a href="/blog/2017/06/updated-yesod-scaffolding">Updated Yesod Scaffolding</a></li></ul></li><li id="nav-201702"><span>February</span><ul><li class="leaf"><a href="/blog/2017/02/changes-yesods-ci">Changes to Yesod&#39;s CI</a></li></ul></li></ul></li><li id="nav-2016"><span>2016</span><ul><li id="nav-201611"><span>November</span><ul><li class="leaf"><a href="/blog/2016/11/new-yesod-devel-server">The New (Experimental) Yesod Development Server - Feedback Requested!</a></li><li class="leaf"><a href="/blog/2016/11/use-mysql-safely-in-yesod">Use MySQL Safely in Yesod Applications</a></li></ul></li><li id="nav-201609"><span>September</span><ul><li class="leaf"><a href="/blog/2016/09/better-ci-yesod-scaffoldings">Better CI for the Yesod scaffoldings</a></li></ul></li><li id="nav-201607"><span>July</span><ul><li class="leaf"><a href="/blog/2016/07/http2-server-push">Implementing HTTP/2 server push</a></li><li class="leaf"><a href="/blog/2016/07/new-http-client-mono-traversable">New http-client and mono-traversable releases</a></li></ul></li><li id="nav-201605"><span>May</span><ul><li class="leaf"><a href="/blog/2016/05/are-unused-import-warnings-harmful">Are unused import warnings harmful?</a></li></ul></li><li id="nav-201604"><span>April</span><ul><li class="leaf"><a href="/blog/2016/04/split-db">Supporting separate read and write databases in persistent</a></li><li class="leaf"><a href="/blog/2016/04/stackifying-the-cookbook">Stackifying the cookbook</a></li><li class="leaf"><a href="/blog/2016/04/fixing-monad-either">Fixing the Monad instance for Either</a></li></ul></li><li id="nav-201603"><span>March</span><ul><li class="leaf"><a href="/blog/2016/03/why-i-prefer-typeclass-based-libraries">Why I prefer typeclass-based libraries</a></li></ul></li><li id="nav-201602"><span>February</span><ul><li class="leaf"><a href="/blog/2016/02/first-class-stream-fusion">First class stream fusion</a></li></ul></li><li id="nav-201601"><span>January</span><ul><li class="leaf"><a href="/blog/2016/01/auto-generate-docbook-xml">Auto generate Docbook XML for the Yesod book</a></li></ul></li></ul></li><li id="nav-2015"><span>2015</span><ul><li id="nav-201512"><span>December</span><ul><li class="leaf"><a href="/blog/2015/12/yesod-hosting-docker-kubernetes">Yesod hosting with Docker and Kubernetes</a></li></ul></li><li id="nav-201510"><span>October</span><ul><li class="leaf"><a href="/blog/2015/10/beginner-friendly-code-and-apis">Beginner friendly code and APIs</a></li><li class="leaf"><a href="/blog/2015/10/resurrecting-servius">Resurrecting servius</a></li><li class="leaf"><a href="/blog/2015/10/using-wais-vault">Using WAI&#39;s vault for fun and profit</a></li></ul></li><li id="nav-201509"><span>September</span><ul><li class="leaf"><a href="/blog/2015/09/true-root-pvp-debate">The true root of the PVP debate</a></li><li class="leaf"><a href="/blog/2015/09/new-runtime-hamlet-api">The new runtime Hamlet API</a></li></ul></li><li id="nav-201508"><span>August</span><ul><li class="leaf"><a href="/blog/2015/08/ssl-server-test">Getting Rating A from the SSL Server Test</a></li><li class="leaf"><a href="/blog/2015/08/thoughts-on-documentation">Some thoughts on documentation</a></li></ul></li><li id="nav-201507"><span>July</span><ul><li class="leaf"><a href="/blog/2015/07/s3-hackage-mirror-travis">S3 Hackage mirror for Travis builds</a></li><li class="leaf"><a href="/blog/2015/07/http2">Supporting HTTP/2</a></li><li class="leaf"><a href="/blog/2015/07/yesod-devel">yesod-devel</a></li><li class="leaf"><a href="/blog/2015/07/yesod-table">yesod-table</a></li></ul></li><li id="nav-201506"><span>June</span><ul><li class="leaf"><a href="/blog/2015/06/stack-support-yesod-devel">stack support for yesod devel</a></li><li class="leaf"><a href="/blog/2015/06/cleaning-up-warp-apis">Cleaning up the Warp APIs</a></li><li class="leaf"><a href="/blog/2015/06/cabals-does-not-exist-error-message">cabal&#39;s does not exist error message</a></li></ul></li><li id="nav-201505"><span>May</span><ul><li class="leaf"><a href="/blog/2015/05/deprecating-system-filepath">Deprecating system-filepath and system-fileio</a></li></ul></li><li id="nav-201504"><span>April</span><ul><li class="leaf"><a href="/blog/2015/04/announcing-stackage-update">Announcing stackage-update</a></li></ul></li><li id="nav-201503"><span>March</span><ul><li class="leaf"><a href="/blog/2015/03/designing-apis-for-extensibility">Designing APIs for Extensibility</a></li></ul></li><li id="nav-201502"><span>February</span><ul><li class="leaf"><a href="/blog/2015/02/awesome-haskell-community">The awesome Haskell community</a></li><li class="leaf"><a href="/blog/2015/02/brittle-haskell-toolchain">The brittle Haskell toolchain</a></li></ul></li><li id="nav-201501"><span>January</span><ul><li class="leaf"><a href="/blog/2015/01/polyconf-2015">PolyConf 2015</a></li></ul></li></ul></li><li id="nav-2014"><span>2014</span><ul><li id="nav-201412"><span>December</span><ul><li class="leaf"><a href="/blog/2014/12/hackage-docs-live-again">Hackage docs live again, please do the READMEs!</a></li><li class="leaf"><a href="/blog/2014/12/use-stackage-for-docs">Use Stackage for docs</a></li><li class="leaf"><a href="/blog/2014/12/minimal-yesod-multifile-site">Minimal Yesod multifile site</a></li><li class="leaf"><a href="/blog/2014/12/yesods-new-scaffolding">Yesod&#39;s new scaffolding</a></li></ul></li><li id="nav-201411"><span>November</span><ul><li class="leaf"><a href="/blog/2014/11/cabal-sandbox-stackage">Installing application dependencies using Stackage, sandboxes, and freezing</a></li><li class="leaf"><a href="/blog/2014/11/case-for-curation">The case for curation: Stackage and the PVP</a></li></ul></li><li id="nav-201410"><span>October</span><ul><li class="leaf"><a href="/blog/2014/10/slides-conduit-ghcjs">Slides on conduit and GHCJS</a></li><li class="leaf"><a href="/blog/2014/10/yesod-gitrepo">Announcing: yesod-gitrepo</a></li><li class="leaf"><a href="/blog/2014/10/classy-base-prelude">Haskell&#39;s Prelude is adding Foldable/Traversable</a></li><li class="leaf"><a href="/blog/2014/10/updating-auto-update">Updating auto-update</a></li></ul></li><li id="nav-201409"><span>September</span><ul><li class="leaf"><a href="/blog/2014/09/announcing-yesod-1-4">Announcing Yesod 1.4</a></li><li class="leaf"><a href="/blog/2014/09/persistent-2.1-released">Persistent 2.1 released</a></li><li class="leaf"><a href="/blog/2014/09/woes-multiple-package-versions">The woes of multiple package versions</a></li><li class="leaf"><a href="/blog/2014/09/persistent-2.1-rc">Persistent 2.1 Release Candidate</a></li><li class="leaf"><a href="/blog/2014/09/clarification-previous-blog-post">Clarification of previous blog post</a></li><li class="leaf"><a href="/blog/2014/09/misassigned-credit-for-conduit">Misassigned credit for conduit</a></li><li class="leaf"><a href="/blog/2014/09/planning-yesod-1-4">Planning Yesod 1.4</a></li></ul></li><li id="nav-201408"><span>August</span><ul><li class="leaf"><a href="/blog/2014/08/announcing-persistent-2">Announcing Persistent 2</a></li><li class="leaf"><a href="/blog/2014/08/deprecating-yesod-platform">Deprecating yesod-platform</a></li><li class="leaf"><a href="/blog/2014/08/announcing-auto-update">Announcing auto-update</a></li></ul></li><li id="nav-201407"><span>July</span><ul><li class="leaf"><a href="/blog/2014/07/reading-files-proc-filesystem">Reading files from the proc filesystem</a></li><li class="leaf"><a href="/blog/2014/07/rfc-new-data-conduit-process">RFC: New Data.Conduit.Process</a></li></ul></li><li id="nav-201406"><span>June</span><ul><li class="leaf"><a href="/blog/2014/06/evil-conditional-compile">Three evil ways to avoid conditional compilation</a></li><li class="leaf"><a href="/blog/2014/06/exceptions-transformers">Exceptions and monad transformers</a></li><li class="leaf"><a href="/blog/2014/06/google-email2">GoogleEmail2 auth plugin</a></li></ul></li><li id="nav-201405"><span>May</span><ul><li class="leaf"><a href="/blog/2014/05/exceptions-cont-monads">Exceptions in continuation-based monads</a></li><li class="leaf"><a href="/blog/2014/05/wai-3-0-alpha">WAI 3.0 alpha release</a></li><li class="leaf"><a href="/blog/2014/05/foldable-mapm-maybe-recursive">Foldable.mapM_, Maybe, and recursive functions</a></li></ul></li><li id="nav-201404"><span>April</span><ul><li class="leaf"><a href="/blog/2014/04/disemboweling-wai">Disemboweling WAI (aka gutting out conduit)</a></li><li class="leaf"><a href="/blog/2014/04/proposal-changes-pvp">Proposal: Changes to the PVP</a></li><li class="leaf"><a href="/blog/2014/04/consolidation-progress">Consolidation progress: shakespeare, conduit, http-client</a></li></ul></li><li id="nav-201403"><span>March</span><ul><li class="leaf"><a href="/blog/2014/03/package-consolidation">Package consolidation</a></li><li class="leaf"><a href="/blog/2014/03/efficient-directory-traversals">Efficient directory traversals</a></li><li class="leaf"><a href="/blog/2014/03/gsoc-proposals">Google Summer of Code proposals</a></li><li class="leaf"><a href="/blog/2014/03/wai-yesod-websockets">WAI 2.1 and yesod-websockets</a></li><li class="leaf"><a href="/blog/2014/03/network-conduit-async">network-conduit, async, and conduit-combinators</a></li></ul></li><li id="nav-201402"><span>February</span><ul><li class="leaf"><a href="/blog/2014/02/module-name-conflicts">Module name conflicts on Hackage</a></li><li class="leaf"><a href="/blog/2014/02/announce-mono-chunked">Announcing mono-traversable, chunked-data, and conduit-combinators</a></li><li class="leaf"><a href="/blog/2014/02/ideas-pipes-parse">Some ideas for pipes-parse</a></li><li class="leaf"><a href="/blog/2014/02/conduit-zip-source">conduit 1.0.13 and ZipSource</a></li><li class="leaf"><a href="/blog/2014/02/new-warp">Improving the performance of Warp again</a></li></ul></li><li id="nav-201401"><span>January</span><ul><li class="leaf"><a href="/blog/2014/01/new-fast-logger">Faster and scalable fast-logger</a></li><li class="leaf"><a href="/blog/2014/01/announcing-resource-monad">Announcing: the Resource monad</a></li><li class="leaf"><a href="/blog/2014/01/initializing-foundation-data">Initializing data in the foundation datatype</a></li><li class="leaf"><a href="/blog/2014/01/conduit-transformer-exception">Improved transformer and exception support in conduit</a></li><li class="leaf"><a href="/blog/2014/01/update-st-monad-conduit">Update: The ST monad and conduit</a></li><li class="leaf"><a href="/blog/2014/01/st-monad-conduit">The ST monad and conduit</a></li><li class="leaf"><a href="/blog/2014/01/psa-please-use-yesod-platform">PSA: Please use yesod-platform</a></li><li class="leaf"><a href="/blog/2014/01/lens-generator-persistent">Lens generator in Persistent</a></li></ul></li></ul></li><li id="nav-2013"><span>2013</span><ul><li id="nav-201312"><span>December</span><ul><li class="leaf"><a href="/blog/2013/12/book-updated-for-1-2">Book fully updated for 1.2</a></li><li class="leaf"><a href="/blog/2013/12/book-updates-1-2">Book updates for 1.2: almost complete!</a></li><li class="leaf"><a href="/blog/2013/12/announcing-wai-2-http-client">Announcing: WAI 2.0 and http-client</a></li></ul></li><li id="nav-201311"><span>November</span><ul><li class="leaf"><a href="/blog/2013/11/wai-2-http-client">WAI 2.0 and http-client</a></li></ul></li><li id="nav-201310"><span>October</span><ul><li class="leaf"><a href="/blog/2013/10/simpler-conduit-core">Simpler conduit core</a></li><li class="leaf"><a href="/blog/2013/10/core-flaw-pipes-conduit">The core flaw of pipes and conduit</a></li><li class="leaf"><a href="/blog/2013/10/pipes-resource-problems">pipes resource problems</a></li><li class="leaf"><a href="/blog/2013/10/segfaults">A warning about segfaults</a></li><li class="leaf"><a href="/blog/2013/10/prelude-replacements-libraries">Prelude replacements are for application developers</a></li></ul></li><li id="nav-201309"><span>September</span><ul><li class="leaf"><a href="/blog/2013/09/classy-mono">Announce: mono-traversable and classy-prelude 0.6</a></li><li class="leaf"><a href="/blog/2013/09/folding-lines-conduit">Folding lines in conduit</a></li><li class="leaf"><a href="/blog/2013/09/zipsinks-conduit-extra">ZipSinks and conduit-extra</a></li><li class="leaf"><a href="/blog/2013/09/yesod-platform-1-2-4">Yesod Platform version 1.2.4</a></li><li class="leaf"><a href="/blog/2013/09/lens-based-classy-prelude">lens-based classy-prelude</a></li></ul></li><li id="nav-201308"><span>August</span><ul><li class="leaf"><a href="/blog/2013/08/exceptions-and-monad-transformers">Exceptions and monad transformers</a></li></ul></li><li id="nav-201307"><span>July</span><ul><li class="leaf"><a href="/blog/2013/07/four-more-chapters">Four more chapters ready</a></li><li class="leaf"><a href="/blog/2013/07/catching-all-exceptions">Catching all exceptions</a></li><li class="leaf"><a href="/blog/2013/07/runtime-lucius-mixins">Runtime Lucius: now with mixins!</a></li></ul></li><li id="nav-201306"><span>June</span><ul><li class="leaf"><a href="/blog/2013/06/first-11-chapters">First 11 chapters are Yesod 1.2-compliant</a></li></ul></li><li id="nav-201305"><span>May</span><ul><li class="leaf"><a href="/blog/2013/05/yesod-1-2-released">Yesod 1.2 released</a></li></ul></li><li id="nav-201304"><span>April</span><ul><li class="leaf"><a href="/blog/2013/04/persistent-1-2-out">Persistent 1.2 is out, last call on Yesod 1.2</a></li><li class="leaf"><a href="/blog/2013/04/mixin-support-in-lucius">Mixin support in Lucius</a></li><li class="leaf"><a href="/blog/2013/04/new-chapter">New chapter: Understanding a Request</a></li><li class="leaf"><a href="/blog/2013/04/shakespeare-typescript">Shakespeare templating updates and TypeScript support</a></li><li class="leaf"><a href="/blog/2013/04/changes-to-online-book">Changes to the online book</a></li></ul></li><li id="nav-201303"><span>March</span><ul><li class="leaf"><a href="/blog/2013/03/simpler-streaming-responses">Simpler streaming responses</a></li><li class="leaf"><a href="/blog/2013/03/yesod-dispatch-version-1-2">Yesod dispatch, version 1.2</a></li><li class="leaf"><a href="/blog/2013/03/big-subsite-rewrite">Big Subsite Rewrite</a></li><li class="leaf"><a href="/blog/2013/03/yesod-1-2-cleaner-internals">Yesod 1.2&#39;s cleaner internals</a></li><li class="leaf"><a href="/blog/2013/03/resourcet-overview">ResourceT Overview</a></li><li class="leaf"><a href="/blog/2013/03/yesod-platform-1-1-8">ANNOUNCE: yesod-platform 1.1.8</a></li></ul></li><li id="nav-201302"><span>February</span><ul><li class="leaf"><a href="/blog/2013/02/announce-conduit-1-0-wai-1-4">ANNOUNCE: conduit 1.0, wai 1.4, and more</a></li><li class="leaf"><a href="/blog/2013/02/upcoming-conduit-1-0">Upcoming conduit 1.0</a></li><li class="leaf"><a href="/blog/2013/02/authentication-for-testing">Authentication during Testing</a></li><li class="leaf"><a href="/blog/2013/02/ajax-with-scaffold">Using Ajax with a Scaffolded Site</a></li></ul></li><li id="nav-201301"><span>January</span><ul><li class="leaf"><a href="/blog/2013/01/school-of-haskell">The School of Haskell</a></li><li class="leaf"><a href="/blog/2013/01/adding-css-js">Cookbook: Adding CSS and Javascript</a></li><li class="leaf"><a href="/blog/2013/01/meaning-of-power">The Meaning of Power</a></li><li class="leaf"><a href="/blog/2013/01/new-goal-yesod-1-2">New goal: Yesod 1.2</a></li><li class="leaf"><a href="/blog/2013/01/so-many-preludes">So many preludes!</a></li></ul></li></ul></li><li id="nav-2012"><span>2012</span><ul><li id="nav-201212"><span>December</span><ul><li class="leaf"><a href="/blog/2012/12/simplified-persistent-types">Simplified Persistent Types</a></li></ul></li><li id="nav-201211"><span>November</span><ul><li class="leaf"><a href="/blog/2012/11/stable-vetted-hackage">Stable, Vetted Hackage: Call for Participation</a></li><li class="leaf"><a href="/blog/2012/11/updates-julius-interpolation">Updates to Julius Interpolation</a></li><li class="leaf"><a href="/blog/2012/11/warp-posa">Warp chapter for Performance of Open Source Applications</a></li><li class="leaf"><a href="/blog/2012/11/solving-cabal-hell">Solving Cabal Hell</a></li><li class="leaf"><a href="/blog/2012/11/changes-scaffolding-system">Changes to scaffolding system</a></li></ul></li><li id="nav-201210"><span>October</span><ul><li class="leaf"><a href="/blog/2012/10/yesod-fay-js">Yesod, AngularJS and Fay</a></li><li class="leaf"><a href="/blog/2012/10/keter-updates">Keter updates</a></li><li class="leaf"><a href="/blog/2012/10/future-work-warp">Future work to improve the performance of Warp</a></li><li class="leaf"><a href="/blog/2012/10/haskell-and-ci">Haskell and Continuous Integration</a></li><li class="leaf"><a href="/blog/2012/10/measuring-warp">Measuring the performance of Warp</a></li><li class="leaf"><a href="/blog/2012/10/yesod-pure">yesod-pure: Use Yesod without Template Haskell</a></li><li class="leaf"><a href="/blog/2012/10/yesod-user-survey-2012">Yesod User Survey 2012</a></li><li class="leaf"><a href="/blog/2012/10/announcing-http-reverse-proxy">Announcing: http-reverse-proxy, unix-process-conduit, and more</a></li><li class="leaf"><a href="/blog/2012/10/jqplot-widget">Yesod composability: a jqPlot widget</a></li><li class="leaf"><a href="/blog/2012/10/generic-monoid">Generics example: creating Monoid instances</a></li><li class="leaf"><a href="/blog/2012/10/avoid-syscall">Avoiding system calls</a></li></ul></li><li id="nav-201209"><span>September</span><ul><li class="leaf"><a href="/blog/2012/09/header-composer">Composing HTTP response headers</a></li><li class="leaf"><a href="/blog/2012/09/caching-fd">Caching file descriptors</a></li><li class="leaf"><a href="/blog/2012/09/project-templates">Haskell Project Templates</a></li><li class="leaf"><a href="/blog/2012/09/header-body">Sending header and body at once</a></li><li class="leaf"><a href="/blog/2012/09/improving-warp">Improving the performance of Warp</a></li><li class="leaf"><a href="/blog/2012/09/building-haskell-ide">Building a Haskell IDE</a></li><li class="leaf"><a href="/blog/2012/09/small-status-update">Small status update</a></li></ul></li><li id="nav-201208"><span>August</span><ul><li class="leaf"><a href="/blog/2012/08/joining-forces-advance-haskell">Joining forces to advance Haskell</a></li><li class="leaf"><a href="/blog/2012/08/announcing-yesod-1-1">Announcing: Yesod 1.1, Persistent 1.0, and a new initiative</a></li><li class="leaf"><a href="/blog/2012/08/webinar-oreilly">O&#39;Reilly Webinar: Designing Type-Safe Haskell APIs</a></li><li class="leaf"><a href="/blog/2012/08/classy-prelude-good-bad-ugly">ClassyPrelude: The good, the bad, and the ugly</a></li></ul></li><li id="nav-201207"><span>July</span><ul><li class="leaf"><a href="/blog/2012/07/shelly-update">State of the Shelly (Haskell scripting lib)</a></li><li class="leaf"><a href="/blog/2012/07/resumablesource">conduit 0.5: ResumableSource and finalization</a></li><li class="leaf"><a href="/blog/2012/07/clarification-classy-prelude">Clarification: classy prelude</a></li><li class="leaf"><a href="/blog/2012/07/announcing-baseless-assertion">Announcing baseless-assertion 0.1</a></li><li class="leaf"><a href="/blog/2012/07/announcing-wai-1-3">Announcing WAI 1.3</a></li><li class="leaf"><a href="/blog/2012/07/classy-prelude">The classy prelude</a></li><li class="leaf"><a href="/blog/2012/07/haskell-vm">The Haskell Virtual Machine</a></li><li class="leaf"><a href="/blog/2012/07/new-logging-system">Yesod&#39;s new logging system</a></li></ul></li><li id="nav-201206"><span>June</span><ul><li class="leaf"><a href="/blog/2012/06/conduit-0-5">conduit 0.5: announcement and example</a></li><li class="leaf"><a href="/blog/2012/06/attoparsec-position">Position information in attoparsec</a></li><li class="leaf"><a href="/blog/2012/06/complicating-conduit">Complicating conduit?</a></li><li class="leaf"><a href="/blog/2012/06/updated-conduit-docs">Updated conduit docs</a></li></ul></li><li id="nav-201205"><span>May</span><ul><li class="leaf"><a href="/blog/2012/05/next-conduit-changes">Next set of conduit changes</a></li><li class="leaf"><a href="/blog/2012/05/response-conduit-bugs">Response to &quot;Conduit Bugs&quot;</a></li><li class="leaf"><a href="/blog/2012/05/keter-its-alive">Keter: It&#39;s Alive!</a></li><li class="leaf"><a href="/blog/2012/05/keter-app-deployment">Keter: Web App Deployment</a></li></ul></li><li id="nav-201204"><span>April</span><ul><li class="leaf"><a href="/blog/2012/04/yesod-js-todo">More Client Side Yesod: todo sample</a></li><li class="leaf"><a href="/blog/2012/04/client-side">Client Side Yesod, an FRP-inspired approach</a></li><li class="leaf"><a href="/blog/2012/04/debugging-openid">A Debugging Adventure: OpenID</a></li><li class="leaf"><a href="/blog/2012/04/skinning-conduits">Many ways to skin a conduit</a></li><li class="leaf"><a href="/blog/2012/04/working-together">Working Together</a></li><li class="leaf"><a href="/blog/2012/04/announcing-yesod-1-0">Announcing Yesod 1.0</a></li><li class="leaf"><a href="/blog/2012/04/cabal-meta">Transcending to dependency heaven</a></li><li class="leaf"><a href="/blog/2012/04/replacing-cabal">Replacing Cabal</a></li></ul></li><li id="nav-201203"><span>March</span><ul><li class="leaf"><a href="/blog/2012/03/summarizing-conduit-questions">Summarizing the conduit questions</a></li><li class="leaf"><a href="/blog/2012/03/pipes-like-conduit">pipes-like conduit</a></li><li class="leaf"><a href="/blog/2012/03/start-mezzo-haskell">Starting the Mezzo Haskell Book</a></li><li class="leaf"><a href="/blog/2012/03/announcing-conduit-0-3">Announcing conduit 0.3</a></li><li class="leaf"><a href="/blog/2012/03/announcing-yesod-platform">Announcing the Yesod Platform</a></li><li class="leaf"><a href="/blog/2012/03/shelly-for-shell-scripts">Shelly: Write your shell scripts in Haskell </a></li><li class="leaf"><a href="/blog/2012/03/cabal-nirvana">Avoid cabal hell: find nirvana</a></li><li class="leaf"><a href="/blog/2012/03/history-of-persistence">A History of Haskell persistence</a></li><li class="leaf"><a href="/blog/2012/03/more-pure-conduit">More Pure Conduit (and benchmarks!)</a></li><li class="leaf"><a href="/blog/2012/03/more-powerful-conduit">A More Powerful Conduit</a></li></ul></li><li id="nav-201202"><span>February</span><ul><li class="leaf"><a href="/blog/2012/02/simplifying-resourcet">Conduits: Simplifying ResourceT</a></li><li class="leaf"><a href="/blog/2012/02/call-for-gsoc-2012">Call for GSoC: bring Haskell to the masses</a></li><li class="leaf"><a href="/blog/2012/02/qcon-video">QCon video and book updates</a></li><li class="leaf"><a href="/blog/2012/02/release-0-10">Announcing Yesod 0.10</a></li><li class="leaf"><a href="/blog/2012/02/persistent-0-8">The New Persistent</a></li><li class="leaf"><a href="/blog/2012/02/answers-about-the-book">Answers about the Yesod book</a></li></ul></li><li id="nav-201201"><span>January</span><ul><li class="leaf"><a href="/blog/2012/01/coming-soon">Coming soon, to a bookstore near you</a></li><li class="leaf"><a href="/blog/2012/01/conduit-changes-0-2">Exciting changes coming to conduit 0.2</a></li><li class="leaf"><a href="/blog/2012/01/persisent-0-7-yesod-0-10-beta">Persistent 0.7, Yesod 0.10 beta</a></li><li class="leaf"><a href="/blog/2012/01/wiki-chat-subsite">Wiki: markdown, chat subsite, event source</a></li><li class="leaf"><a href="/blog/2012/01/new-pet-peeve">My New Pet Peeve</a></li><li class="leaf"><a href="/blog/2012/01/warp-conduits">Warp Conduits Released!</a></li><li class="leaf"><a href="/blog/2012/01/aosa-chapter">AOSA Chapter on Yesod</a></li><li class="leaf"><a href="/blog/2012/01/conduit-versus-enumerator">Conduits versus enumerators</a></li><li class="leaf"><a href="/blog/2012/01/blog-example">Blog: i18n, authentication, authorization, and database</a></li><li class="leaf"><a href="/blog/2012/01/conduits-buffering">Conduits, part 5: Buffering</a></li><li class="leaf"><a href="/blog/2012/01/http-conduit">http-conduit</a></li><li class="leaf"><a href="/blog/2012/01/conduits-conduits">Conduits, part 4: Conduits</a></li></ul></li></ul></li><li class="open" id="nav-2011"><span>2011</span><ul><li id="nav-201112"><span>December</span><ul><li class="leaf"><a href="/blog/2011/12/future-of-http-enumerator">The future of http-enumerator</a></li><li class="leaf"><a href="/blog/2011/12/conduits-sink">Conduits, part 3: Sinks</a></li><li class="leaf"><a href="/blog/2011/12/0-9-4-release">Yesod 0.9.4 Released</a></li><li class="leaf"><a href="/blog/2011/12/conduits">Conduits</a></li><li class="leaf"><a href="/blog/2011/12/resourcet">The Resource monad transformer</a></li><li class="leaf"><a href="/blog/2011/12/variable-naming-context">Good variable naming is context dependent </a></li><li class="leaf"><a href="/blog/2011/12/yesod-scaffolded-site">Scaffolding and the Site Template</a></li><li class="leaf"><a href="/blog/2011/12/please-use-packdeps">Please use Packdeps!</a></li></ul></li><li id="nav-201111"><span>November</span><ul><li class="leaf"><a href="/blog/2011/11/cabal-src">Announcing cabal-src</a></li><li class="leaf"><a href="/blog/2011/11/got-right">What Yesod got Right</a></li></ul></li><li id="nav-201110"><span>October</span><ul><li class="leaf"><a href="/blog/2011/10/code-generation-conversation">Code that writes code and conversation about conversations</a></li><li class="leaf"><a href="/blog/2011/10/frameworks-drive">Frameworks drive language adoption</a></li><li class="leaf"><a href="/blog/2011/10/xml-enumerator">xml-enumerator</a></li><li class="leaf"><a href="/blog/2011/10/yesods-monads">Yesod&#39;s Monads</a></li><li class="leaf"><a href="/blog/2011/10/settings-types">Settings Types</a></li></ul></li><li id="nav-201109"><span>September</span><ul><li class="leaf"><a href="/blog/2011/09/new-book-content">New Book Content</a></li><li class="leaf"><a href="/blog/2011/09/case-study-sphinx">Case Study: Sphinx-based Search</a></li><li class="leaf"><a href="/blog/2011/09/yesod-0.9.2">Yesod 0.9.2 - Everything Just Works</a></li><li class="leaf"><a href="/blog/2011/09/limitations-of-haskell">The Limitations of Haskell</a></li></ul></li><li class="open" id="nav-201108"><span>August</span><ul><li class="leaf"><a href="/blog/2011/08/new-forms-chapter">Forms 0.9</a></li><li class="leaf"><a href="/blog/2011/08/announcing-yesod-0.9">Yesod 0.9 Release Anouncement</a></li><li class="leaf"><a class="current" href="/blog/2011/08/persistent-0-6-0">Persistent 0.6.0</a></li><li class="leaf"><a href="/blog/2011/08/0.9-rc3-and-scaffold-upgrade">Yesod 0.9 Release Candidate 3</a></li><li class="leaf"><a href="/blog/2011/08/monad-control">monad-control</a></li><li class="leaf"><a href="/blog/2011/08/yesod-0-9-release-candidate">Announcing Yesod 0.9.0 Release Candidate</a></li><li class="leaf"><a href="/blog/2011/08/perils-partially-powered-languages">The Perils of Partially Powered Languages</a></li><li class="leaf"><a href="/blog/2011/08/shakespeare">New Shakespeare Chapter</a></li><li class="leaf"><a href="/blog/2011/08/yesod-form-overhaul">Yesod form overhaul</a></li><li class="leaf"><a href="/blog/2011/08/pdf-book">PDF version of the Yesod book</a></li></ul></li><li id="nav-201107"><span>July</span><ul><li class="leaf"><a href="/blog/2011/07/yesod-reorg">The Great Yesod Reorganization of 2011</a></li><li class="leaf"><a href="/blog/2011/07/haskell-on-heroku">Haskell on Heroku</a></li><li class="leaf"><a href="/blog/2011/07/browserid-support">BrowserID support</a></li><li class="leaf"><a href="/blog/2011/07/yesod-community">Yesod Community</a></li><li class="leaf"><a href="/blog/2011/07/syntax-highlighting">Line numbering/syntax highlighting added</a></li></ul></li><li id="nav-201106"><span>June</span><ul><li class="leaf"><a href="/blog/2011/06/yesod-docs-haskellwiki">Yesod and Haskell Docs</a></li><li class="leaf"><a href="/blog/2011/06/cookbook-part-2">Cookbook, part 2</a></li><li class="leaf"><a href="/blog/2011/06/building-better-chm">Building a Better CHM</a></li><li class="leaf"><a href="/blog/2011/06/cookbook">Cookbook</a></li></ul></li><li id="nav-201105"><span>May</span><ul><li class="leaf"><a href="/blog/2011/05/yesod-for-non-haskellers">Yesod for non-Haskellers</a></li><li class="leaf"><a href="/blog/2011/05/introducing-yesod-wiki">Introducing the Yesod Wiki</a></li><li class="leaf"><a href="/blog/2011/05/forms-api-decisions">Forms API Decisions (and some status updates)</a></li><li class="leaf"><a href="/blog/2011/05/yesod-form-revamp">Yesod Form Revamp</a></li><li class="leaf"><a href="/blog/2011/05/non-poly-hamlet-i18n">Non-Polymorphic Hamlet and I18N</a></li><li class="leaf"><a href="/blog/2011/05/warp-article-functional-web">Warp article in &quot;The Functional Web&quot;</a></li></ul></li><li id="nav-201104"><span>April</span><ul><li class="leaf"><a href="/blog/2011/04/announcing-yesod-0-8">Announcing Yesod 0.8</a></li><li class="leaf"><a href="/blog/2011/04/yesod-template-haskell">Yesod and Template Haskell</a></li><li class="leaf"><a href="/blog/2011/04/new-site-design">New site design, and some book progress</a></li><li class="leaf"><a href="/blog/2011/04/beta-yesod-0-8">Beta Release: Yesod 0.8</a></li><li class="leaf"><a href="/blog/2011/04/announcing-wai-0-4">Announcing WAI/Warp 0.4.0</a></li><li class="leaf"><a href="/blog/2011/04/rails-can-scale">Rails can scale- auto-convert it to the framework formerly known as Yesod!</a></li></ul></li><li id="nav-201103"><span>March</span><ul><li class="leaf"><a href="/blog/2011/03/improving-persistent-performance">Improving Persistent Performance</a></li><li class="leaf"><a href="/blog/2011/03/hamlet-lucius-widgets">Hamlet, Lucius and Widgets, oh my!</a></li><li class="leaf"><a href="/blog/2011/03/preliminary-warp-cross-language-benchmarks">Preliminary Warp Cross-Language Benchmarks</a></li><li class="leaf"><a href="/blog/2011/03/road-to-yesod-1-0">The Road to Yesod 1.0</a></li></ul></li><li id="nav-201102"><span>February</span><ul><li class="leaf"><a href="/blog/2011/02/warp-speed-ahead">Warp Speed Ahead</a></li><li class="leaf"><a href="/blog/2011/02/chapters-1-4">Yesod Book: Chapters 1-4 updated</a></li><li class="leaf"><a href="/blog/2011/02/routing-changes-yesod-0-7">Routing Changes in Yesod 0.7</a></li><li class="leaf"><a href="/blog/2011/02/reverse-packdeps">Reverse Packdeps</a></li><li class="leaf"><a href="/blog/2011/02/announcing-yesod-0-7">Announcing Yesod 0.7</a></li><li class="leaf"><a href="/blog/2011/02/yesod-migration-guide">Yesod 0.7 Migration Guide</a></li></ul></li><li id="nav-201101"><span>January</span><ul><li class="leaf"><a href="/blog/2011/01/hamlet6to7">Hamlet 6 to 7</a></li><li class="leaf"><a href="/blog/2011/01/announcing-warp">Announcing the Warp web server</a></li><li class="leaf"><a href="/blog/2011/01/data-object-yaml">data-object-yaml package</a></li><li class="leaf"><a href="/blog/2011/01/i18n-in-haskell">I18N in Haskell</a></li><li class="leaf"><a href="/blog/2011/01/announcing-wai-0-3">Announcing Web Application Interface 0.3.0</a></li></ul></li></ul></li><li id="nav-2010"><span>2010</span><ul><li id="nav-201012"><span>December</span><ul><li class="leaf"><a href="/blog/2010/12/announcing-yackage">Announcing Yackage: Your personal Hackage server for testing</a></li><li class="leaf"><a href="/blog/2010/12/magic-of-yesod-part2">The Magic of Yesod, part 2</a></li><li class="leaf"><a href="/blog/2010/12/magic-of-yesod-part1">The Magic of Yesod, part 1</a></li><li class="leaf"><a href="/blog/2010/12/yesod-user-survey">Yesod User Survey</a></li><li class="leaf"><a href="/blog/2010/12/announcing-xml-enumerator">Announcing XML Enumerator</a></li><li class="leaf"><a href="/blog/2010/12/serendipity-wai-http-enumerator">Serendipity: WAI and http-enumerator</a></li><li class="leaf"><a href="/blog/2010/12/yesods-own-world">Library versus Framework: Yesod&#39;s Own World</a></li><li class="leaf"><a href="/blog/2010/12/early-december-update">Early December Update</a></li></ul></li><li id="nav-201011"><span>November</span><ul><li class="leaf"><a href="/blog/2010/11/new-book-comments-system">New book comments system, and a new site design</a></li><li class="leaf"><a href="/blog/2010/11/wishlist">Wishlist</a></li><li class="leaf"><a href="/blog/2010/11/yesod-0-6-3">Yesod 0.6.3 Released</a></li><li class="leaf"><a href="/blog/2010/11/javascript-minification">Javascript Minification</a></li><li class="leaf"><a href="/blog/2010/11/atomic-field-modification-persistent">Atomic Field Modification in Persistent</a></li><li class="leaf"><a href="/blog/2010/11/please-break-yesod">Please Break Yesod</a></li></ul></li><li id="nav-201010"><span>October</span><ul><li class="leaf"><a href="/blog/2010/10/yesod-0-6">Yesod 0.6.0 Released</a></li><li class="leaf"><a href="/blog/2010/10/custom-forms">Custom Forms and the Form Monad</a></li><li class="leaf"><a href="/blog/2010/10/invertible-monads-exceptions-allocations">Invertible monads for exception handling and memory allocations</a></li><li class="leaf"><a href="/blog/2010/10/forms-chapter-written">Forms Chapter Written</a></li><li class="leaf"><a href="/blog/2010/10/announcing-zlib-bindings">Announcing zlib-bindings</a></li><li class="leaf"><a href="/blog/2010/10/enumerators-tutorial-part-3">Enumerators Tutorial Part 3: Enumeratee</a></li><li class="leaf"><a href="/blog/2010/10/haskellers-and-openid">Haskellers.com and OpenID</a></li><li class="leaf"><a href="/blog/2010/10/enumerators-tutorial-part-2">Enumerators Tutorial Part 2: Enumerator</a></li></ul></li><li id="nav-201009"><span>September</span><ul><li class="leaf"><a href="/blog/2010/09/enumerators-tutorial-part-1">Enumerators Tutorial Part 1: Iteratee</a></li><li class="leaf"><a href="/blog/2010/09/yesod-0-5-1">Yesod 0.5.1: HTML sanitization, generalized Hamlet and pluggable authentication</a></li><li class="leaf"><a href="/blog/2010/09/announcing-http-enumerator">Announcing http-enumerator</a></li><li class="leaf"><a href="/blog/2010/09/modular-authentication">Modular Authentication</a></li><li class="leaf"><a href="/blog/2010/09/wai-handler-devel">WAI development server (aka, skip the compiles)</a></li><li class="leaf"><a href="/blog/2010/09/yammer-screencast">Yammer Screencast</a></li><li class="leaf"><a href="/blog/2010/09/yo-dawg-template-haskell">Yo dawg, I heard you like Template Haskell</a></li><li class="leaf"><a href="/blog/2010/09/adding-varnish">Adding a little varnish</a></li></ul></li><li id="nav-201008"><span>August</span><ul><li class="leaf"><a href="/blog/2010/08/yesod-0-5">Yesod 0.5.0 Released</a></li><li class="leaf"><a href="/blog/2010/08/orange-roster">Orange Roster</a></li><li class="leaf"><a href="/blog/2010/08/static-file-optimizations">Static File Optimizations</a></li><li class="leaf"><a href="/blog/2010/08/typesafe-runtime-hamlet">Type-safe runtime Hamlet</a></li><li class="leaf"><a href="/blog/2010/08/whats-in-a-hamlet">What&#39;s in a Hamlet?</a></li></ul></li><li id="nav-201007"><span>July</span><ul><li class="leaf"><a href="/blog/2010/07/database-migrations">Recent update: database migrations and more</a></li><li class="leaf"><a href="/blog/2010/07/wai-handler-snap">wai-handler-snap: Run Yesod apps on the Snap server</a></li><li class="leaf"><a href="/blog/2010/07/yesod-0-4">Yesod 0.4.0 Released</a></li><li class="leaf"><a href="/blog/2010/07/wai-0-2-ideas">Web Application Interface 0.2 Ideas</a></li><li class="leaf"><a href="/blog/2010/07/sessions">Sessions</a></li><li class="leaf"><a href="/blog/2010/07/first-stab-at-widgets">First Stab at Widgets</a></li></ul></li><li id="nav-201006"><span>June</span><ul><li class="leaf"><a href="/blog/2010/06/some-plumbing-fixes">Some Plumbing Fixes</a></li><li class="leaf"><a href="/blog/2010/06/fringe-benefits-typesafe-urls">Fringe benefits of type-safe URLs</a></li><li class="leaf"><a href="/blog/2010/06/first-persistent-new-yesod">First Persistent release, new Yesod release</a></li><li class="leaf"><a href="/blog/2010/06/hamlet-and-persistent">Hamlet 0.3.0 and Persistent documentation</a></li><li class="leaf"><a href="/blog/2010/06/restful-content">RESTful Content</a></li><li class="leaf"><a href="/blog/2010/06/handler-monad">The Handler Monad</a></li><li class="leaf"><a href="/blog/2010/06/optimizing-hamlet-minor-correction">Optimizing Hamlet (a minor correction)</a></li><li class="leaf"><a href="/blog/2010/06/optimizing-hamlet">Optimizing Hamlet</a></li><li class="leaf"><a href="/blog/2010/06/formlets-meet-hamlet">Formlets meet Hamlet</a></li></ul></li><li id="nav-201005"><span>May</span><ul><li class="leaf"><a href="/blog/2010/05/persistent-blog-example">Persistent Blog Example- with Redis support!</a></li><li class="leaf"><a href="/blog/2010/05/persistent-progress">Persistent Progress</a></li><li class="leaf"><a href="/blog/2010/05/persistence-thoughts">Persistence Thoughts</a></li><li class="leaf"><a href="/blog/2010/05/bigtable-benchmarks">Bigtable Benchmarks</a></li><li class="leaf"><a href="/blog/2010/05/yesod-0-2-0-released">Yesod 0.2.0 Released</a></li><li class="leaf"><a href="/blog/2010/05/laying-the-foundation">Laying the Foundation</a></li><li class="leaf"><a href="/blog/2010/05/status-update">Status Update</a></li><li class="leaf"><a href="/blog/2010/05/really-type-safe-urls">Really type-safe URLs</a></li><li class="leaf"><a href="/blog/2010/05/hamlet-version-0-2">Hamlet Version 0.2</a></li><li class="leaf"><a href="/blog/2010/05/migrating-to-yesod-0-2">Migrating to Yesod 0.2</a></li></ul></li><li id="nav-201004"><span>April</span><ul><li class="leaf"><a href="/blog/2010/04/yesod-mini-tutorial">Yesod 0.2 Mini Tutorial</a></li><li class="leaf"><a href="/blog/2010/04/pedantic">Pedantic</a></li><li class="leaf"><a href="/blog/2010/04/hamlet-is-born">Hamlet is Born</a></li><li class="leaf"><a href="/blog/2010/04/whats-cooking-with-yesod">What&#39;s Cooking with Yesod</a></li></ul></li><li id="nav-201003"><span>March</span><ul><li class="leaf"><a href="/blog/2010/03/persistent-plugs">Persistent Plugs</a></li><li class="leaf"><a href="/blog/2010/03/persistence">Persistence</a></li><li class="leaf"><a href="/blog/2010/03/tweedle-beetle-battle">Tweedle Beetle Battle</a></li></ul></li><li id="nav-201002"><span>February</span><ul><li class="leaf"><a href="/blog/2010/02/simpler-is-better">Simpler is Better</a></li><li class="leaf"><a href="/blog/2010/02/request-body-interfaces">Four HTTP Request Body Interfaces</a></li></ul></li><li id="nav-201001"><span>January</span><ul><li class="leaf"><a href="/blog/2010/01/efficient-yaml-parsing-followup">Efficient YAML Parsing- Follow up</a></li><li class="leaf"><a href="/blog/2010/01/with-monadio">With MonadIO</a></li><li class="leaf"><a href="/blog/2010/01/efficient-yaml-parsing">Efficient YAML Parsing</a></li><li class="leaf"><a href="/blog/2010/01/new-blog-system">New Blog System</a></li></ul></li></ul></li></ul></div></section><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script><script>var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function c(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function j(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function g(t,s){var r="";for(var q=0;q<t.childNodes.length;q++){if(t.childNodes[q].nodeType==3){var p=t.childNodes[q].nodeValue;if(s){p=p.replace(/\n/g,"")}r+=p}else{if(t.childNodes[q].nodeName=="BR"){r+="\n"}else{r+=g(t.childNodes[q])}}}if(/MSIE [678]/.test(navigator.userAgent)){r=r.replace(/\r/g,"\n")}return r}function a(s){var q=s.className.split(/\s+/);q=q.concat(s.parentNode.className.split(/\s+/));for(var p=0;p<q.length;p++){var r=q[p].replace(/^language-/,"");if(d[r]||r=="no-highlight"){return r}}}function b(p){var q=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{q.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);q.push({event:"stop",offset:t,node:s.childNodes[r]})}}}return t})(p,0);return q}function l(y,z,x){var r=0;var w="";var t=[];function u(){if(y.length&&z.length){if(y[0].offset!=z[0].offset){return(y[0].offset<z[0].offset)?y:z}else{return z[0].event=="start"?y:z}}else{return y.length?y:z}}function s(C){var D="<"+C.nodeName.toLowerCase();for(var A=0;A<C.attributes.length;A++){var B=C.attributes[A];D+=" "+B.nodeName.toLowerCase();if(B.nodeValue!=undefined&&B.nodeValue!=false&&B.nodeValue!=null){D+='="'+m(B.nodeValue)+'"'}}return D+">"}while(y.length||z.length){var v=u().splice(0,1)[0];w+=m(x.substr(r,v.offset-r));r=v.offset;if(v.event=="start"){w+=s(v.node);t.push(v.node)}else{if(v.event=="stop"){var q=t.length;do{q--;var p=t[q];w+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);t.splice(q,1);while(q<t.length){w+=s(t[q]);q++}}}}w+=x.substr(r);return w}function i(){function p(u,t,v){if(u.compiled){return}if(!v){u.bR=c(t,u.b?u.b:"\\B|\\b");if(!u.e&&!u.eW){u.e="\\B|\\b"}if(u.e){u.eR=c(t,u.e)}}if(u.i){u.iR=c(t,u.i)}if(u.r==undefined){u.r=1}if(u.k){u.lR=c(t,u.l||hljs.IR,true)}for(var s in u.k){if(!u.k.hasOwnProperty(s)){continue}if(u.k[s] instanceof Object){u.kG=u.k}else{u.kG={keyword:u.k}}break}if(!u.c){u.c=[]}u.compiled=true;for(var r=0;r<u.c.length;r++){p(u.c[r],t,false)}if(u.starts){p(u.starts,t,false)}}for(var q in d){if(!d.hasOwnProperty(q)){continue}p(d[q].dM,d[q],true)}}function e(J,D){if(!i.called){i();i.called=true}function z(r,M){for(var L=0;L<M.c.length;L++){if(M.c[L].bR.test(r)){return M.c[L]}}}function w(L,r){if(C[L].e&&C[L].eR.test(r)){return 1}if(C[L].eW){var M=w(L-1,r);return M?M+1:0}return 0}function x(r,L){return L.iR&&L.iR.test(r)}function A(O,N){var M=[];for(var L=0;L<O.c.length;L++){M.push(O.c[L].b)}var r=C.length-1;do{if(C[r].e){M.push(C[r].e)}r--}while(C[r+1].eW);if(O.i){M.push(O.i)}return c(N,"("+M.join("|")+")",true)}function s(M,L){var N=C[C.length-1];if(!N.t){N.t=A(N,H)}N.t.lastIndex=L;var r=N.t.exec(M);if(r){return[M.substr(L,r.index-L),r[0],false]}else{return[M.substr(L),"",true]}}function p(O,r){var L=H.cI?r[0].toLowerCase():r[0];for(var N in O.kG){if(!O.kG.hasOwnProperty(N)){continue}var M=O.kG[N].hasOwnProperty(L);if(M){return[N,M]}}return false}function F(M,O){if(!O.k){return m(M)}var N="";var P=0;O.lR.lastIndex=0;var L=O.lR.exec(M);while(L){N+=m(M.substr(P,L.index-P));var r=p(O,L);if(r){t+=r[1];N+='<span class="'+r[0]+'">'+m(L[0])+"</span>"}else{N+=m(L[0])}P=O.lR.lastIndex;L=O.lR.exec(M)}N+=m(M.substr(P,M.length-P));return N}function K(r,M){if(M.sL&&d[M.sL]){var L=e(M.sL,r);t+=L.keyword_count;return L.value}else{return F(r,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){q+=L;M.buffer=""}else{if(M.eB){q+=m(r)+L;M.buffer=""}else{q+=L;M.buffer=r}}C.push(M);B+=M.r}function E(O,L,Q){var R=C[C.length-1];if(Q){q+=K(R.buffer+O,R);return false}var M=z(L,R);if(M){q+=K(R.buffer+O,R);I(M,L);return M.rB}var r=w(C.length-1,L);if(r){var N=R.cN?"</span>":"";if(R.rE){q+=K(R.buffer+O,R)+N}else{if(R.eE){q+=K(R.buffer+O,R)+N+m(L)}else{q+=K(R.buffer+O+L,R)+N}}while(r>1){N=C[C.length-2].cN?"</span>":"";q+=N;r--;C.length--}var P=C[C.length-1];C.length--;C[C.length-1].buffer="";if(P.starts){I(P.starts,"")}return R.rE}if(x(L,R)){throw"Illegal"}}var H=d[J];var C=[H.dM];var B=0;var t=0;var q="";try{var v=0;H.dM.buffer="";do{var y=s(D,v);var u=E(y[0],y[1],y[2]);v+=y[0].length;if(!u){v+=y[1].length}}while(!y[2]);if(C.length>1){throw"Illegal"}return{r:B,keyword_count:t,value:q}}catch(G){if(G=="Illegal"){return{r:0,keyword_count:0,value:m(D)}}else{throw G}}}function f(t){var r={keyword_count:0,r:0,value:m(t)};var q=r;for(var p in d){if(!d.hasOwnProperty(p)){continue}var s=e(p,t);s.language=p;if(s.keyword_count+s.r>q.keyword_count+q.r){q=s}if(s.keyword_count+s.r>r.keyword_count+r.r){q=r;r=s}}if(q.language){r.second_best=q}return r}function h(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function o(u,x,q){var y=g(u,q);var s=a(u);if(s=="no-highlight"){return}if(s){var w=e(s,y)}else{var w=f(y);s=w.language}var p=b(u);if(p.length){var r=document.createElement("pre");r.innerHTML=w.value;w.value=l(p,b(r),y)}w.value=h(w.value,x,q);var t=u.className;if(!t.match("(\\s|^)(language-)?"+s+"(\\s|$)")){t=t?(t+" "+s):s}if(/MSIE [678]/.test(navigator.userAgent)&&u.tagName=="CODE"&&u.parentNode.tagName=="PRE"){var r=u.parentNode;var v=document.createElement("div");v.innerHTML="<pre><code>"+w.value+"</code></pre>";u=v.firstChild.firstChild;v.firstChild.cN=r.cN;r.parentNode.replaceChild(v.firstChild,r)}else{u.innerHTML=w.value}u.className=t;u.result={language:s,kw:w.keyword_count,re:w.r};if(w.second_best){u.second_best={language:w.second_best.language,kw:w.second_best.keyword_count,re:w.second_best.r}}}function k(){if(k.called){return}k.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=j(r[p]);if(q){o(q,hljs.tabReplace)}}}function n(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",k,false);window.addEventListener("load",k,false)}else{if(window.attachEvent){window.attachEvent("onload",k)}else{window.onload=k}}}var d={};this.LANGUAGES=d;this.highlight=e;this.highlightAuto=f;this.fixMarkup=h;this.highlightBlock=o;this.initHighlighting=k;this.initHighlightingOnLoad=n;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0x[A-Za-z0-9]+|\\d+(\\.\\d+)?)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.inherit=function(p,s){var r={};for(var q in p){r[q]=p[q]}if(s){for(var q in s){r[q]=s[q]}}return r}}();hljs.LANGUAGES.bash=function(){var d={"true":1,"false":1};var b={cN:"variable",b:"\\$([a-zA-Z0-9_]+)\\b"};var a={cN:"variable",b:"\\$\\{(([^}])|(\\\\}))+\\}",c:[hljs.CNM]};var c={cN:"string",b:'"',e:'"',i:"\\n",c:[hljs.BE,b,a],r:0};var e={cN:"test_condition",b:"",e:"",c:[c,b,a,hljs.CNM],k:{literal:d},r:0};return{dM:{k:{keyword:{"if":1,then:1,"else":1,fi:1,"for":1,"break":1,"continue":1,"while":1,"in":1,"do":1,done:1,echo:1,exit:1,"return":1,set:1,declare:1},literal:d},c:[{cN:"shebang",b:"(#!\\/bin\\/bash)|(#!\\/bin\\/sh)",r:10},hljs.HCM,hljs.CNM,c,b,a,hljs.inherit(e,{b:"\\[ ",e:" \\]",r:0}),hljs.inherit(e,{b:"\\[\\[ ",e:" \\]\\]"})]}}}();hljs.LANGUAGES.javascript={dM:{k:{keyword:{"in":1,"if":1,"for":1,"while":1,"finally":1,"var":1,"new":1,"function":1,"do":1,"return":1,"void":1,"else":1,"break":1,"catch":1,"instanceof":1,"with":1,"throw":1,"case":1,"default":1,"try":1,"this":1,"switch":1,"continue":1,"typeof":1,"delete":1},literal:{"true":1,"false":1,"null":1}},c:[hljs.ASM,hljs.QSM,hljs.CLCM,hljs.CBLCLM,hljs.CNM,{b:"("+hljs.RSR+"|case|return|throw)\\s*",k:{"return":1,"throw":1,"case":1},c:[hljs.CLCM,hljs.CBLCLM,{cN:"regexp",b:"/",e:"/[gim]*",c:[{b:"\\\\/"}]}],r:0},{cN:"function",b:"\\bfunction\\b",e:"{",k:{"function":1},c:[{cN:"title",b:"[A-Za-z$_][0-9A-Za-z$_]*"},{cN:"params",b:"\\(",e:"\\)",c:[hljs.ASM,hljs.QSM,hljs.CLCM,hljs.CBLCLM]}]}]}};hljs.LANGUAGES.css=function(){var a={cN:"function",b:hljs.IR+"\\(",e:"\\)",c:[{eW:true,eE:true,c:[hljs.NM,hljs.ASM,hljs.QSM]}]};return{cI:true,dM:{i:"[=/|']",c:[hljs.CBLCLM,{cN:"id",b:"\\#[A-Za-z0-9_-]+"},{cN:"class",b:"\\.[A-Za-z0-9_-]+",r:0},{cN:"attr_selector",b:"\\[",e:"\\]",i:"$"},{cN:"pseudo",b:":(:)?[a-zA-Z0-9\\_\\-\\+\\(\\)\\\"\\']+"},{cN:"at_rule",b:"@(font-face|page)",l:"[a-z-]+",k:{"font-face":1,page:1}},{cN:"at_rule",b:"@",e:"[{;]",eE:true,k:{"import":1,page:1,media:1,charset:1},c:[a,hljs.ASM,hljs.QSM,hljs.NM]},{cN:"tag",b:hljs.IR,r:0},{cN:"rules",b:"{",e:"}",i:"[^\\s]",r:0,c:[hljs.CBLCLM,{cN:"rule",b:"[^\\s]",rB:true,e:";",eW:true,c:[{cN:"attribute",b:"[A-Z\\_\\.\\-]+",e:":",eE:true,i:"[^\\s]",starts:{cN:"value",eW:true,eE:true,c:[a,hljs.NM,hljs.QSM,hljs.ASM,hljs.CBLCLM,{cN:"hexcolor",b:"\\#[0-9A-F]+"},{cN:"important",b:"!important"}]}}]}]}]}}}();hljs.LANGUAGES.xml=function(){var b="[A-Za-z0-9\\._:-]+";var a={eW:true,c:[{cN:"attribute",b:b,r:0},{b:'="',rB:true,e:'"',c:[{cN:"value",b:'"',eW:true}]},{b:"='",rB:true,e:"'",c:[{cN:"value",b:"'",eW:true}]},{b:"=",c:[{cN:"value",b:"[^\\s/>]+"}]}]};return{cI:true,dM:{c:[{cN:"pi",b:"<\\?",e:"\\?>",r:10},{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},{cN:"comment",b:"<!--",e:"-->",r:10},{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style",e:">",k:{title:{style:1}},c:[a],starts:{cN:"css",e:"</style>",rE:true,sL:"css"}},{cN:"tag",b:"<script",e:">",k:{title:{script:1}},c:[a],starts:{cN:"javascript",e:"<\/script>",rE:true,sL:"javascript"}},{cN:"vbscript",b:"<%",e:"%>",sL:"vbscript"},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:"[^ />]+"},a]}]}}}();hljs.LANGUAGES.java={dM:{k:{"false":1,"synchronized":1,"int":1,"abstract":1,"float":1,"private":1,"char":1,"interface":1,"boolean":1,"static":1,"null":1,"if":1,"const":1,"for":1,"true":1,"while":1,"long":1,"throw":1,strictfp:1,"finally":1,"protected":1,"extends":1,"import":1,"native":1,"final":1,"implements":1,"return":1,"void":1,"enum":1,"else":1,"break":1,"transient":1,"new":1,"catch":1,"instanceof":1,"byte":1,"super":1,"class":1,"volatile":1,"case":1,assert:1,"short":1,"package":1,"default":1,"double":1,"public":1,"try":1,"this":1,"switch":1,"continue":1,"throws":1},c:[{cN:"javadoc",b:"/\\*\\*",e:"\\*/",c:[{cN:"javadoctag",b:"@[A-Za-z]+"}],r:10},hljs.CLCM,hljs.CBLCLM,hljs.ASM,hljs.QSM,{cN:"class",b:"(class |interface )",e:"{",k:{"class":1,"interface":1},i:":",c:[{b:"(implements|extends)",k:{"extends":1,"implements":1},r:10},{cN:"title",b:hljs.UIR}]},hljs.CNM,{cN:"annotation",b:"@[A-Za-z]+"}]}};hljs.LANGUAGES.haskell=function(){var a={cN:"label",b:"\\b[A-Z][\\w']*",r:0};var b={cN:"container",b:"\\(",e:"\\)",c:[{cN:"label",b:"\\b[A-Z][\\w\\(\\)\\.']*"},{cN:"title",b:"[_a-z][\\w']*"}]};return{dM:{k:{keyword:{let:1,"in":1,"if":1,then:1,"else":1,"case":1,of:1,where:1,"do":1,module:1,"import":1,hiding:1,qualified:1,type:1,data:1,newtype:1,deriving:1,"class":1,instance:1,"null":1,not:1,as:1}},c:[{cN:"comment",b:"--",e:"$"},{cN:"comment",b:"{-",e:"-}"},{cN:"string",b:"\\s+'",e:"'",c:[hljs.BE],r:0},hljs.QSM,{cN:"import",b:"\\bimport",e:"$",k:{"import":1,qualified:1,as:1,hiding:1},c:[b]},{cN:"module",b:"\\bmodule",e:"where",k:{module:1,where:1},c:[b]},{cN:"class",b:"\\b(class|instance|data|(new)?type)",e:"(where|$)",k:{"class":1,where:1,instance:1,data:1,type:1,newtype:1,deriving:1},c:[a]},hljs.CNM,{cN:"shebang",b:"#!\\/usr\\/bin\\/env runhaskell",e:"$"},a,{cN:"title",b:"^[_a-z][\\w']*"}]}}}();hljs.LANGUAGES.sql={cI:true,dM:{i:"[^\\s]",c:[{cN:"operator",b:"(begin|start|commit|rollback|savepoint|lock|alter|create|drop|rename|call|delete|do|handler|insert|load|replace|select|truncate|update|set|show|pragma)\\b",e:";|$",k:{keyword:{all:1,partial:1,global:1,month:1,current_timestamp:1,using:1,go:1,revoke:1,smallint:1,indicator:1,"end-exec":1,disconnect:1,zone:1,"with":1,character:1,assertion:1,to:1,add:1,current_user:1,usage:1,input:1,local:1,alter:1,match:1,collate:1,real:1,then:1,rollback:1,get:1,read:1,timestamp:1,session_user:1,not:1,integer:1,bit:1,unique:1,day:1,minute:1,desc:1,insert:1,execute:1,like:1,ilike:2,level:1,decimal:1,drop:1,"continue":1,isolation:1,found:1,where:1,constraints:1,domain:1,right:1,national:1,some:1,module:1,transaction:1,relative:1,second:1,connect:1,escape:1,close:1,system_user:1,"for":1,deferred:1,section:1,cast:1,current:1,sqlstate:1,allocate:1,intersect:1,deallocate:1,numeric:1,"public":1,preserve:1,full:1,"goto":1,initially:1,asc:1,no:1,key:1,output:1,collation:1,group:1,by:1,union:1,session:1,both:1,last:1,language:1,constraint:1,column:1,of:1,space:1,foreign:1,deferrable:1,prior:1,connection:1,unknown:1,action:1,commit:1,view:1,or:1,first:1,into:1,"float":1,year:1,primary:1,cascaded:1,except:1,restrict:1,set:1,references:1,names:1,table:1,outer:1,open:1,select:1,size:1,are:1,rows:1,from:1,prepare:1,distinct:1,leading:1,create:1,only:1,next:1,inner:1,authorization:1,schema:1,corresponding:1,option:1,declare:1,precision:1,immediate:1,"else":1,timezone_minute:1,external:1,varying:1,translation:1,"true":1,"case":1,exception:1,join:1,hour:1,"default":1,"double":1,scroll:1,value:1,cursor:1,descriptor:1,values:1,dec:1,fetch:1,procedure:1,"delete":1,and:1,"false":1,"int":1,is:1,describe:1,"char":1,as:1,at:1,"in":1,varchar:1,"null":1,trailing:1,any:1,absolute:1,current_time:1,end:1,grant:1,privileges:1,when:1,cross:1,check:1,write:1,current_date:1,pad:1,begin:1,temporary:1,exec:1,time:1,update:1,catalog:1,user:1,sql:1,date:1,on:1,identity:1,timezone_hour:1,natural:1,whenever:1,interval:1,work:1,order:1,cascade:1,diagnostics:1,nchar:1,having:1,left:1,call:1,"do":1,handler:1,load:1,replace:1,truncate:1,start:1,lock:1,show:1,pragma:1},aggregate:{count:1,sum:1,min:1,max:1,avg:1}},c:[{cN:"string",b:"'",e:"'",c:[hljs.BE,{b:"''"}],r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE,{b:'""'}],r:0},{cN:"string",b:"`",e:"`",c:[hljs.BE]},hljs.CNM,{b:"\\n"}]},hljs.CBLCLM,{cN:"comment",b:"--",e:"$"}]}};hljs.LANGUAGES.nginx=function(){var c={cN:"variable",b:"\\$\\d+"};var b={cN:"variable",b:"\\${",e:"}"};var a={cN:"variable",b:"[\\$\\@]"+hljs.UIR};return{dM:{c:[hljs.HCM,{b:hljs.UIR,e:";|{",rE:true,k:{accept_mutex:1,accept_mutex_delay:1,access_log:1,add_after_body:1,add_before_body:1,add_header:1,addition_types:1,alias:1,allow:1,ancient_browser:1,ancient_browser:1,ancient_browser_value:1,ancient_browser_value:1,auth_basic:1,auth_basic_user_file:1,autoindex:1,autoindex_exact_size:1,autoindex_localtime:1,"break":1,charset:1,charset:1,charset_map:1,charset_map:1,charset_types:1,charset_types:1,client_body_buffer_size:1,client_body_in_file_only:1,client_body_in_single_buffer:1,client_body_temp_path:1,client_body_timeout:1,client_header_buffer_size:1,client_header_timeout:1,client_max_body_size:1,connection_pool_size:1,connections:1,create_full_put_path:1,daemon:1,dav_access:1,dav_methods:1,debug_connection:1,debug_points:1,default_type:1,deny:1,directio:1,directio_alignment:1,echo:1,echo_after_body:1,echo_before_body:1,echo_blocking_sleep:1,echo_duplicate:1,echo_end:1,echo_exec:1,echo_flush:1,echo_foreach_split:1,echo_location:1,echo_location_async:1,echo_read_request_body:1,echo_request_body:1,echo_reset_timer:1,echo_sleep:1,echo_subrequest:1,echo_subrequest_async:1,empty_gif:1,empty_gif:1,env:1,error_log:1,error_log:1,error_page:1,events:1,expires:1,fastcgi_bind:1,fastcgi_buffer_size:1,fastcgi_buffers:1,fastcgi_busy_buffers_size:1,fastcgi_cache:1,fastcgi_cache_key:1,fastcgi_cache_methods:1,fastcgi_cache_min_uses:1,fastcgi_cache_path:1,fastcgi_cache_use_stale:1,fastcgi_cache_valid:1,fastcgi_catch_stderr:1,fastcgi_connect_timeout:1,fastcgi_hide_header:1,fastcgi_ignore_client_abort:1,fastcgi_ignore_headers:1,fastcgi_index:1,fastcgi_intercept_errors:1,fastcgi_max_temp_file_size:1,fastcgi_next_upstream:1,fastcgi_param:1,fastcgi_pass:1,fastcgi_pass_header:1,fastcgi_pass_request_body:1,fastcgi_pass_request_headers:1,fastcgi_read_timeout:1,fastcgi_send_lowat:1,fastcgi_send_timeout:1,fastcgi_split_path_info:1,fastcgi_store:1,fastcgi_store_access:1,fastcgi_temp_file_write_size:1,fastcgi_temp_path:1,fastcgi_upstream_fail_timeout:1,fastcgi_upstream_max_fails:1,flv:1,geo:1,geo:1,geoip_city:1,geoip_country:1,gzip:1,gzip_buffers:1,gzip_comp_level:1,gzip_disable:1,gzip_hash:1,gzip_http_version:1,gzip_min_length:1,gzip_no_buffer:1,gzip_proxied:1,gzip_static:1,gzip_types:1,gzip_vary:1,gzip_window:1,http:1,"if":1,if_modified_since:1,ignore_invalid_headers:1,image_filter:1,image_filter_buffer:1,image_filter_jpeg_quality:1,image_filter_transparency:1,include:1,index:1,internal:1,ip_hash:1,js:1,js_load:1,js_require:1,js_utf8:1,keepalive_requests:1,keepalive_timeout:1,kqueue_changes:1,kqueue_events:1,large_client_header_buffers:1,limit_conn:1,limit_conn_log_level:1,limit_except:1,limit_rate:1,limit_rate_after:1,limit_req:1,limit_req_log_level:1,limit_req_zone:1,limit_zone:1,lingering_time:1,lingering_timeout:1,listen:1,location:1,lock_file:1,log_format:1,log_not_found:1,log_subrequest:1,map:1,map_hash_bucket_size:1,map_hash_max_size:1,master_process:1,memcached_bind:1,memcached_buffer_size:1,memcached_connect_timeout:1,memcached_next_upstream:1,memcached_pass:1,memcached_read_timeout:1,memcached_send_timeout:1,memcached_upstream_fail_timeout:1,memcached_upstream_max_fails:1,merge_slashes:1,min_delete_depth:1,modern_browser:1,modern_browser:1,modern_browser_value:1,modern_browser_value:1,more_clear_headers:1,more_clear_input_headers:1,more_set_headers:1,more_set_input_headers:1,msie_padding:1,msie_refresh:1,multi_accept:1,open_file_cache:1,open_file_cache_errors:1,open_file_cache_events:1,open_file_cache_min_uses:1,open_file_cache_retest:1,open_file_cache_valid:1,open_log_file_cache:1,optimize_server_names:1,output_buffers:1,override_charset:1,override_charset:1,perl:1,perl_modules:1,perl_require:1,perl_set:1,pid:1,port_in_redirect:1,post_action:1,postpone_gzipping:1,postpone_output:1,proxy_bind:1,proxy_buffer_size:1,proxy_buffering:1,proxy_buffers:1,proxy_busy_buffers_size:1,proxy_cache:1,proxy_cache_key:1,proxy_cache_methods:1,proxy_cache_min_uses:1,proxy_cache_path:1,proxy_cache_use_stale:1,proxy_cache_valid:1,proxy_connect_timeout:1,proxy_headers_hash_bucket_size:1,proxy_headers_hash_max_size:1,proxy_hide_header:1,proxy_ignore_client_abort:1,proxy_ignore_headers:1,proxy_intercept_errors:1,proxy_max_temp_file_size:1,proxy_method:1,proxy_next_upstream:1,proxy_pass:1,proxy_pass_header:1,proxy_pass_request_body:1,proxy_pass_request_headers:1,proxy_read_timeout:1,proxy_redirect:1,proxy_send_lowat:1,proxy_send_timeout:1,proxy_set_body:1,proxy_set_header:1,proxy_store:1,proxy_store_access:1,proxy_temp_file_write_size:1,proxy_temp_path:1,proxy_upstream_fail_timeout:1,proxy_upstream_max_fails:1,push_authorized_channels_only:1,push_channel_group:1,push_max_channel_id_length:1,push_max_channel_subscribers:1,push_max_message_buffer_length:1,push_max_reserved_memory:1,push_message_buffer_length:1,push_message_timeout:1,push_min_message_buffer_length:1,push_min_message_recipients:1,push_publisher:1,push_store_messages:1,push_subscriber:1,push_subscriber_concurrency:1,random_index:1,read_ahead:1,real_ip_header:1,recursive_error_pages:1,request_pool_size:1,reset_timedout_connection:1,resolver:1,resolver_timeout:1,"return":1,rewrite:1,rewrite_log:1,root:1,satisfy:1,satisfy_any:1,send_lowat:1,send_timeout:1,sendfile:1,sendfile_max_chunk:1,server:1,server:1,server_name:1,server_name_in_redirect:1,server_names_hash_bucket_size:1,server_names_hash_max_size:1,server_tokens:1,set:1,set_real_ip_from:1,source_charset:1,source_charset:1,ssi:1,ssi_ignore_recycled_buffers:1,ssi_min_file_chunk:1,ssi_silent_errors:1,ssi_types:1,ssi_value_length:1,ssl:1,ssl_certificate:1,ssl_certificate_key:1,ssl_ciphers:1,ssl_client_certificate:1,ssl_crl:1,ssl_dhparam:1,ssl_prefer_server_ciphers:1,ssl_protocols:1,ssl_session_cache:1,ssl_session_timeout:1,ssl_verify_client:1,ssl_verify_depth:1,sub_filter:1,sub_filter_once:1,sub_filter_types:1,tcp_nodelay:1,tcp_nopush:1,timer_resolution:1,try_files:1,types:1,types_hash_bucket_size:1,types_hash_max_size:1,underscores_in_headers:1,uninitialized_variable_warn:1,upstream:1,use:1,user:1,userid:1,userid:1,userid_domain:1,userid_domain:1,userid_expires:1,userid_expires:1,userid_mark:1,userid_name:1,userid_name:1,userid_p3p:1,userid_p3p:1,userid_path:1,userid_path:1,userid_service:1,userid_service:1,valid_referers:1,variables_hash_bucket_size:1,variables_hash_max_size:1,worker_connections:1,worker_cpu_affinity:1,worker_priority:1,worker_processes:1,worker_rlimit_core:1,worker_rlimit_nofile:1,worker_rlimit_sigpending:1,working_directory:1,xml_entities:1,xslt_stylesheet:1,xslt_types:1},r:0,c:[hljs.HCM,{b:"\\s",e:"[;{]",rB:true,rE:true,l:"[a-z/]+",k:{built_in:{on:1,off:1,yes:1,no:1,"true":1,"false":1,none:1,blocked:1,debug:1,info:1,notice:1,warn:1,error:1,crit:1,select:1,permanent:1,redirect:1,kqueue:1,rtsig:1,epoll:1,poll:1,"/dev/poll":1}},r:0,c:[hljs.HCM,{cN:"string",b:'"',e:'"',c:[hljs.BE,c,b,a],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE,c,b,a],r:0},{cN:"string",b:"([a-z]+):/",e:"[;\\s]",rE:true},{cN:"regexp",b:"\\s\\^",e:"\\s|{|;",rE:true,c:[hljs.BE,c,b,a]},{cN:"regexp",b:"~\\*?\\s+",e:"\\s|{|;",rE:true,c:[hljs.BE,c,b,a]},{cN:"regexp",b:"\\*(\\.[a-z\\-]+)+",c:[hljs.BE,c,b,a]},{cN:"regexp",b:"([a-z\\-]+\\.)+\\*",c:[hljs.BE,c,b,a]},{cN:"number",b:"\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b"},{cN:"number",b:"\\s\\d+[kKmMgGdshdwy]*\\b",r:0},c,b,a]}]}]}}}();$(function(){
    $("#archive li").has("ul").click(function(event){
        if (event.target.id == $(this).attr("id")) $(this).toggleClass("open");
    });
});
hljs.initHighlightingOnLoad();
</script><footer id="license" style="text-align:center;font-size:0.8em">All content on this site is available under the
<a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
<br>
Content outside the book section is available under
<a href="https://raw.github.com/yesodweb/yesodweb.com/master/LICENSE">the MIT license</a>
as well.</footer>
</div></div><script>window._gaq = [['_setAccount','UA-1434510-13'],['_trackPageview'],['_trackPageLoadTime']];(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script><!-- Prompt IE 6 users to install Chrome Frame. Remove this if you want to support IE 6.  chromium.org/developers/how-tos/chrome-frame-getting-started --><!--[if lt IE 7 ]><script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script><script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script><![endif]--></body></html>